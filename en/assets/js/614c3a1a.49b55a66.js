"use strict";(self.webpackChunkchaosblade=self.webpackChunkchaosblade||[]).push([[3878],{3905:function(e,a,t){t.d(a,{Zo:function(){return s},kt:function(){return u}});var n=t(7294);function o(e,a,t){return a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e}function r(e,a){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);a&&(n=n.filter((function(a){return Object.getOwnPropertyDescriptor(e,a).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var a=1;a<arguments.length;a++){var t=null!=arguments[a]?arguments[a]:{};a%2?r(Object(t),!0).forEach((function(a){o(e,a,t[a])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(a){Object.defineProperty(e,a,Object.getOwnPropertyDescriptor(t,a))}))}return e}function i(e,a){if(null==e)return{};var t,n,o=function(e,a){if(null==e)return{};var t,n,o={},r=Object.keys(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||(o[t]=e[t]);return o}(e,a);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(n=0;n<r.length;n++)t=r[n],a.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var c=n.createContext({}),p=function(e){var a=n.useContext(c),t=a;return e&&(t="function"==typeof e?e(a):l(l({},a),e)),t},s=function(e){var a=p(e.components);return n.createElement(c.Provider,{value:a},e.children)},d={inlineCode:"code",wrapper:function(e){var a=e.children;return n.createElement(n.Fragment,{},a)}},m=n.forwardRef((function(e,a){var t=e.components,o=e.mdxType,r=e.originalType,c=e.parentName,s=i(e,["components","mdxType","originalType","parentName"]),m=p(t),u=o,g=m["".concat(c,".").concat(u)]||m[u]||d[u]||r;return t?n.createElement(g,l(l({ref:a},s),{},{components:t})):n.createElement(g,l({ref:a},s))}));function u(e,a){var t=arguments,o=a&&a.mdxType;if("string"==typeof e||o){var r=t.length,l=new Array(r);l[0]=m;var i={};for(var c in a)hasOwnProperty.call(a,c)&&(i[c]=a[c]);i.originalType=e,i.mdxType="string"==typeof e?e:o,l[1]=i;for(var p=2;p<r;p++)l[p]=t[p];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},6876:function(e,a,t){t.r(a),t.d(a,{assets:function(){return c},contentTitle:function(){return l},default:function(){return d},frontMatter:function(){return r},metadata:function(){return i},toc:function(){return p}});var n=t(7462),o=(t(7294),t(3905));const r={title:"ChaosBlade Java \u573a\u666f\u6027\u80fd\u4f18\u5316\uff0c\u90a3\u4e9b\u4f60\u4e0d\u77e5\u9053\u7684\u4e8b",authors:"binbin",tags:["chaosblade"],description:"\u672c\u6587\u4f1a\u7740\u91cd\u4ecb\u7ecd\u4ec0\u4e48chaosblade java\u573a\u666f\u6027\u80fd\u4f18\u5316\u7684\u5b9e\u73b0\u3002",hide_table_of_contents:!1},l="1.\u4ecb\u7ecd",i={permalink:"/en/blog/2022/09/09/chaosblade-java",editUrl:"https://github.com/chaosblade-io/chaosblade-website/edit/master/website/blog/blog/2022-09-09-chaosblade-java.md",source:"@site/blog/2022-09-09-chaosblade-java.md",title:"ChaosBlade Java \u573a\u666f\u6027\u80fd\u4f18\u5316\uff0c\u90a3\u4e9b\u4f60\u4e0d\u77e5\u9053\u7684\u4e8b",description:"\u672c\u6587\u4f1a\u7740\u91cd\u4ecb\u7ecd\u4ec0\u4e48chaosblade java\u573a\u666f\u6027\u80fd\u4f18\u5316\u7684\u5b9e\u73b0\u3002",date:"2022-09-09T00:00:00.000Z",formattedDate:"September 9, 2022",tags:[{label:"chaosblade",permalink:"/en/blog/tags/chaosblade"}],readingTime:27.43,hasTruncateMarker:!0,authors:[{name:"\u5f20\u658c\u658c\uff08@binbin0325\uff09",title:"Committer of ChaosBlade",url:"https://github.com/binbin0325",imageURL:"https://avatars.githubusercontent.com/u/28588342?v=4",key:"binbin"}],frontMatter:{title:"ChaosBlade Java \u573a\u666f\u6027\u80fd\u4f18\u5316\uff0c\u90a3\u4e9b\u4f60\u4e0d\u77e5\u9053\u7684\u4e8b",authors:"binbin",tags:["chaosblade"],description:"\u672c\u6587\u4f1a\u7740\u91cd\u4ecb\u7ecd\u4ec0\u4e48chaosblade java\u573a\u666f\u6027\u80fd\u4f18\u5316\u7684\u5b9e\u73b0\u3002",hide_table_of_contents:!1},nextItem:{title:"ChaosBlade-Box\u5168\u65b0\u6df7\u6c8c\u5de5\u7a0b\u5e73\u53f0 -- \u52a9\u529b\u4f01\u4e1a\u6df7\u6c8c\u5de5\u7a0b\u843d\u5730",permalink:"/en/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released-ch"}},c={authorsImageUrls:[void 0]},p=[{value:"3.1 \u73b0\u8c61",id:"31-\u73b0\u8c61",level:2},{value:"3.2 \u5b9a\u4f4d",id:"32-\u5b9a\u4f4d",level:2},{value:"3.3 \u4f18\u5316",id:"33-\u4f18\u5316",level:2},{value:"3.4 \u6539\u8fdb\u540e\u6548\u679c",id:"34-\u6539\u8fdb\u540e\u6548\u679c",level:2},{value:"4.1 dubbo\u6545\u969c\u4f18\u5316",id:"41-dubbo\u6545\u969c\u4f18\u5316",level:2},{value:"4.1.1 \u95ee\u9898\u63cf\u8ff0",id:"411-\u95ee\u9898\u63cf\u8ff0",level:3},{value:"4.1.2 \u4f18\u5316",id:"412-\u4f18\u5316",level:3},{value:"4.2 \u81ea\u5b9a\u4e49\u811a\u672c\u6545\u969c\u4f18\u5316",id:"42-\u81ea\u5b9a\u4e49\u811a\u672c\u6545\u969c\u4f18\u5316",level:2},{value:"4.2.1 \u95ee\u9898\u63cf\u8ff0",id:"421-\u95ee\u9898\u63cf\u8ff0",level:3},{value:"4.2.2 \u95ee\u9898\u6392\u67e5",id:"422-\u95ee\u9898\u6392\u67e5",level:3},{value:"4.2.3 \u4f18\u5316",id:"423-\u4f18\u5316",level:3},{value:"4.3 \u65e5\u5fd7\u6253\u5370\u4f18\u5316",id:"43-\u65e5\u5fd7\u6253\u5370\u4f18\u5316",level:2},{value:"4.3.1 \u95ee\u9898\u63cf\u8ff0",id:"431-\u95ee\u9898\u63cf\u8ff0",level:3},{value:"4.3.2 \u4f18\u5316",id:"432-\u4f18\u5316",level:3},{value:"5.1 \u73b0\u8c61",id:"51-\u73b0\u8c61",level:2},{value:"5.2 \u5b9a\u4f4d",id:"52-\u5b9a\u4f4d",level:2},{value:"5.3 \u4f18\u5316",id:"53-\u4f18\u5316",level:2},{value:"5.4 \u6539\u8fdb\u540e\u6548\u679c",id:"54-\u6539\u8fdb\u540e\u6548\u679c",level:2},{value:"5.4 \u518d\u6b21\u4f18\u5316",id:"54-\u518d\u6b21\u4f18\u5316",level:2},{value:"6.1 \u95ee\u9898\u63cf\u8ff0",id:"61-\u95ee\u9898\u63cf\u8ff0",level:2}],s={toc:p};function d(e){let{components:a,...t}=e;return(0,o.kt)("wrapper",(0,n.Z)({},s,t,{components:a,mdxType:"MDXLayout"}),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://chaosblade.io/"},"ChaosBlade")," \u662f\u963f\u91cc\u5df4\u5df4\u5f00\u6e90\u7684\u4e00\u6b3e\u9075\u5faa\u6df7\u6c8c\u5de5\u7a0b\u539f\u7406\u548c\u6df7\u6c8c\u5b9e\u9a8c\u6a21\u578b\u7684\u5b9e\u9a8c\u6ce8\u5165\u5de5\u5177\uff0c\u5e2e\u52a9\u4f01\u4e1a\u63d0\u5347\u5206\u5e03\u5f0f\u7cfb\u7edf\u7684\u5bb9\u9519\u80fd\u529b\uff0c\u5e76\u4e14\u5728\u4f01\u4e1a\u4e0a\u4e91\u6216\u5f80\u4e91\u539f\u751f\u7cfb\u7edf\u8fc1\u79fb\u8fc7\u7a0b\u4e2d\u4e1a\u52a1\u8fde\u7eed\u6027\u4fdd\u969c\u3002"),(0,o.kt)("p",null,"\u76ee\u524d\u652f\u6301\u7684\u573a\u666f\u6709\uff1a\u57fa\u7840\u8d44\u6e90\u3001Java \u5e94\u7528\u3001C++ \u5e94\u7528\u3001Docker \u5bb9\u5668\u4ee5\u53ca Kubernetes \u5e73\u53f0\u3002\u8be5\u9879\u76ee\u5c06\u573a\u666f\u6309\u9886\u57df\u5b9e\u73b0\u5c01\u88c5\u6210\u5355\u72ec\u7684\u9879\u76ee\uff0c\u4e0d\u4ec5\u53ef\u4ee5\u4f7f\u9886\u57df\u5185\u573a\u666f\u6807\u51c6\u5316\u5b9e\u73b0\uff0c\u800c\u4e14\u975e\u5e38\u65b9\u4fbf\u573a\u666f\u6c34\u5e73\u548c\u5782\u76f4\u6269\u5c55\uff0c\u901a\u8fc7\u9075\u5faa\u6df7\u6c8c\u5b9e\u9a8c\u6a21\u578b\uff0c\u5b9e\u73b0 ChaosBlade cli \u7edf\u4e00\u8c03\u7528\u3002"),(0,o.kt)("p",null,"\u4e0d\u8fc7Java\u573a\u666f\u4e0b\u7684\u6545\u969c\u6ce8\u5165\u76ee\u524d\u6709\u4e00\u4e9b\u6027\u80fd\u95ee\u9898,\u4e3b\u8981\u4f53\u73b0\u5728\u6545\u969c\u6ce8\u5165\u65f6\u4f1a\u8ba9CPU\u7684\u4f7f\u7528\u7387\u5927\u5e45\u5ea6\u6296\u52a8,\u4e25\u91cd\u60c5\u51b5\u4e0b\u53ef\u80fd\u4f1a\u5bfc\u81f4CPU\u7684\u4f7f\u7528\u7387100%\u3002\u8fd9\u79cd\u60c5\u51b5\u5bf9\u4e8e\u7ebf\u4e0b\u670d\u52a1\u7684\u5f71\u54cd\u8fd8\u597d\uff0c\u4f46\u662f\u5bf9\u4e8e\u7ebf\u4e0a\u670d\u52a1\u5c31\u6bd4\u8f83\u4e25\u91cd\u4e86\uff0c\u56e0\u4e3aCPU\u7684\u4f7f\u7528\u7387\u8f83\u9ad8\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4\u670d\u52a1\u7684\u6574\u4f53\u6027\u80fd\u53d8\u5dee\uff0c\u4ece\u800c\u5f71\u54cd\u63a5\u53e3\u7684\u8017\u65f6\u3002"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u901a\u8fc7\u5bf9ChaosBlade Java \u573a\u666f\u7684\u6027\u80fd\u4f18\u5316\uff0c\u4f7fCPU\u5728\u6545\u969c\u6ce8\u5165\u65f6\u7684\u6296\u52a8\u5f97\u5230\u4e86\u6709\u6548\u7684\u63a7\u5236\uff0c\u4e0d\u4f1a\u518d\u51fa\u73b0CPU\u4f7f\u7528\u7387\u8fbe\u5230100%\u7684\u6296\u52a8\uff0c\u7ecf\u8fc7\u6d4b\u8bd5\u5728\u7ebf\u4e0a8C\uff0c4G\uff0cQPS 3K\u5de6\u53f3\u7684\u670d\u52a1\u5b9e\u4f8b\u4e0a\u6ce8\u5165Dubbo \u81ea\u5b9a\u4e49\u629b\u5f02\u5e38\u7684\u6545\u969c\uff0cCPU\u7684\u4f7f\u7528\u7387\u53ef\u4ee5\u63a7\u5236\u572840%\u5de6\u53f3\u7684\u77ac\u65f6\u6296\u52a8\u8303\u56f4\u5185,\u6027\u80fd\u6574\u4f53\u63d0\u5347\u8fd12.5\u500d\u3002")),(0,o.kt)("p",null,"\u672c\u6587\u5c06\u4f1a\u8be6\u7ec6\u7684\u4ecb\u7ecd\u5f71\u54cd\u6027\u80fd\u7684\u95ee\u9898\u70b9\u4ee5\u53ca\u662f\u5982\u4f55\u5bf9\u8fd9\u4e9b\u95ee\u9898\u8fdb\u884c\u4f18\u5316\u7684\u3002"),(0,o.kt)("h1",{id:"2java\u573a\u666f"},"2.Java\u573a\u666f"),(0,o.kt)("p",null,"\u5728\u4ecb\u7ecd\u524d\u5148\u4e86\u89e3\u4e0bChaosBlade Java\u573a\u666f\u7684\u6ce8\u5165\u6d41\u7a0b\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662014005578-270f85a6-fd83-4e0a-b43b-dc97eb26f510.png#clientId=u52ad7d43-5028-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=232&id=u536ca7fe&margin=%5Bobject%20Object%5D&name=image.png&originHeight=464&originWidth=1598&originalType=binary&ratio=1&rotation=0&showTitle=false&size=107988&status=done&style=none&taskId=u5f0cd5e6-7193-4e6e-8b83-392a6b276dc&title=&width=799",alt:"image.png"}),"Java\u573a\u666f\u7684\u6545\u969c\u6ce8\u5165\u662f\u57fa\u4e8e\u5b57\u8282\u7801\u589e\u5f3a\u6846\u67b6JVM-Sandbox\u5b9e\u73b0\u7684\uff0c\u6ce8\u5165\u4e00\u4e2a\u6545\u969c\u5206\u4e3a\u4e24\u6b65\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"ChaosBlade \u6267\u884cprepare\u547d\u4ee4\uff0c\u89e6\u53d1sandbox\u5bf9\u76ee\u6807JVM\u6302\u8f7d Java agent\u3002"),(0,o.kt)("li",{parentName:"ol"},"ChaosBlade \u6267\u884ccreate\u547d\u4ee4\uff0c\u89e6\u53d1sandbox\u5bf9\u76ee\u6807JVM\u8fdb\u884c\u5b57\u8282\u7801\u589e\u5f3a\uff0c\u4ece\u800c\u8fbe\u5230\u6545\u969c\u6ce8\u5165\u7684\u76ee\u7684\u3002")),(0,o.kt)("h1",{id:"3prepare\u6302\u8f7d\u9636\u6bb5\u4f18\u5316"},"3.prepare(\u6302\u8f7d)\u9636\u6bb5\u4f18\u5316"),(0,o.kt)("h2",{id:"31-\u73b0\u8c61"},"3.1 \u73b0\u8c61"),(0,o.kt)("p",null,"\u672c\u5730\u6a21\u62df\u4e00\u4e2a\u7b80\u5355\u7684HTTP\u670d\u52a1\uff0c\u63a7\u5236\u5176CPU Idle\u572850%\u5de6\u53f3\uff0c\u5f53\u6267\u884cblade prepare jvm --pid\u6302\u8f7dagent\u540e\uff0c\u53d1\u73b0CPU\u7a7a\u95f2\u7387\u8fc5\u901f\u4e0b\u964d\uff0c\u5e76\u4e14\u4e0b\u964d\u7684\u5e45\u5ea6\u8f83\u5927\u3002\u5728\u751f\u4ea7\u4e2d\u8fdb\u884c\u6545\u969c\u6ce8\u5165\u6709\u53ef\u80fd\u4f1a\u76f4\u63a5\u8ba9Idle\u6389\u4f4e\u4ece\u800c\u89e6\u53d1\u544a\u8b66"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662014042664-6aa32560-c4ad-4cf9-af1c-12bbe48d3ef6.png#clientId=u52ad7d43-5028-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=172&id=u78f2e45e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=274&originWidth=1188&originalType=binary&ratio=1&rotation=0&showTitle=false&size=82193&status=done&style=none&taskId=u4e1a626e-a680-4a97-899e-090dc4062f5&title=&width=745",alt:"image.png"})),(0,o.kt)("h2",{id:"32-\u5b9a\u4f4d"},"3.2 \u5b9a\u4f4d"),(0,o.kt)("p",null,"\u901a\u8fc7\u91c7\u96c6CPU profile\u751f\u6210\u706b\u7130\u56fe\u6765\u89c2\u5bdf\u5728\u6267\u884cblade prepare\u65f6CPU\u7684\u4f7f\u7528\u60c5\u51b5\uff0c\u5982\u4e0b\u56fe\u53ef\u4ee5\u770b\u5230loadPlugins\u65b9\u6cd5\u662f\u8d44\u6e90\u6d88\u8017\u7684\u91cd\u707e\u533a"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662014182779-f714d227-c3c4-45ce-822b-7b68bc23e0b8.png#clientId=u52ad7d43-5028-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=325&id=u24cbcf93&margin=%5Bobject%20Object%5D&name=image.png&originHeight=484&originWidth=1074&originalType=binary&ratio=1&rotation=0&showTitle=false&size=354434&status=done&style=none&taskId=u2fe4bf22-dd36-46c5-adf4-77b0adb50c6&title=&width=721"},"image.png")),(0,o.kt)("p",null,"loadPlugins\u65b9\u6cd5\u4e2d\u4e3b\u8981\u662f\u52a0\u8f7dChaosBlade Java\u4e2d\u652f\u6301\u7684\u5168\u90e8\u63d2\u4ef6\uff0c\u4f8b\u5982dubbo,redis,kafka\u7b49\u3002\u5f53\u52a0\u8f7d\u4e86\u8fd9\u4e9b\u63d2\u4ef6\u540e\u5c31\u53ef\u4ee5\u8fdb\u884c\u6545\u969c\u6ce8\u5165\u4e86\u3002\u52a0\u8f7d\u63d2\u4ef6\u7684\u8fc7\u7a0b\u4e2d\u4f1a\u5bf9\u63d2\u4ef6\u4e2d\u5b9a\u4e49\u7684\u7c7b\u4ee5\u53ca\u65b9\u6cd5\u8fdb\u884c\u5b57\u8282\u7801\u589e\u5f3a\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662014673785-ea235bde-77c7-49da-a083-df8cf33a8fee.png#clientId=u1e121cd7-cea1-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=u9a60fe1b&margin=%5Bobject%20Object%5D&name=attach%26%E5%8A%A0%E8%BD%BD.png&originHeight=258&originWidth=1532&originalType=binary&ratio=1&rotation=0&showTitle=false&size=30862&status=done&style=none&taskId=u69b3ea87-d7a9-4501-ab63-a88d77fea12&title=",alt:"attach&\u52a0\u8f7d.png"})),(0,o.kt)("p",null,"\u5bfc\u81f4CPU\u6d88\u8017\u7684\u95ee\u9898\u5c31\u5728\u4e8e\u52a0\u8f7d\u5168\u91cf\u7684\u63d2\u4ef6\u8017\u65f6\u8f83\u5927\uff0c\u800c\u6211\u4eec\u6545\u969c\u6ce8\u5165\u65f6\u4f1a\u9009\u62e9\u5177\u4f53\u67d0\u4e2a\u63d2\u4ef6\u8fdb\u884c\u6545\u969c\u6ce8\u5165\uff0c\u663e\u7136\u5168\u91cf\u52a0\u8f7d\u5e76\u4e0d\u662f\u6700\u4f18\u89e3"),(0,o.kt)("h2",{id:"33-\u4f18\u5316"},"3.3 \u4f18\u5316"),(0,o.kt)("p",null,"\u4f18\u5316\u601d\u8def:\u65e2\u7136\u6545\u969c\u6ce8\u5165\u65f6\u4f1a\u9009\u62e9\u5177\u4f53\u7684\u63d2\u4ef6\uff0c\u90a3\u4e48\u901a\u8fc7\u61d2\u52a0\u8f7d\u7684\u65b9\u5f0f\u5373\u53ef\u89e3\u51b3\uff0c\u5f53\u6211\u4eec\u8981\u9488\u5bf9\u54ea\u4e00\u4e2a\u63d2\u4ef6\u6545\u969c\u6ce8\u5165\u5c31\u52a0\u8f7d\u54ea\u4e2a\u63d2\u4ef6\uff0c\u52a0\u8f7d\u7684\u7c92\u5ea6\u53d8\u5c0f\uff0cCPU\u7684\u6d88\u8017\u81ea\u7136\u5c31\u5c0f\u4e86\n",(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662014682629-b696cbe2-83ff-42d4-bcd8-ffa3212b51c3.png#clientId=u1e121cd7-cea1-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=uf7664a78&margin=%5Bobject%20Object%5D&name=attach.png&originHeight=250&originWidth=1438&originalType=binary&ratio=1&rotation=0&showTitle=false&size=28442&status=done&style=none&taskId=ua75afa23-dfe9-4a58-967f-918be317eac&title=",alt:"attach.png"})),(0,o.kt)("p",null,"\u6838\u5fc3\u4ee3\u7801\uff1a\n\u5728\u6545\u969c\u6ce8\u5165\u9636\u6bb5\uff0c\u901a\u8fc7\u6307\u5b9a\u7684\u63d2\u4ef6\u8fdb\u884c\u61d2\u52a0\u8f7d\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'private void lazyLoadPlugin(ModelSpec modelSpec, Model model) throws ExperimentException {\n    PluginLifecycleListener listener = ManagerFactory.getListenerManager().getPluginLifecycleListener();\n    if (listener == null) {\n        throw new ExperimentException("can get plugin listener");\n    }\n    PluginBeans pluginBeans = ManagerFactory.getPluginManager().getPlugins(modelSpec.getTarget());\n    if (pluginBeans == null) {\n        throw new ExperimentException("can get plugin bean");\n    }\n    if (pluginBeans.isLoad()) {\n        return;\n    }\n    listener.add(pluginBean);\n    ManagerFactory.getPluginManager().setLoad(pluginBeans, modelSpec.getTarget());\n}\n')),(0,o.kt)("p",null,"\u8be6\u7ec6\u4ee3\u7801PR:",(0,o.kt)("a",{parentName:"p",href:"https://github.com/chaosblade-io/chaosblade-exec-jvm/pull/233"},"https://github.com/ChaosBlade-io/ChaosBlade-exec-jvm/pull/233")),(0,o.kt)("h2",{id:"34-\u6539\u8fdb\u540e\u6548\u679c"},"3.4 \u6539\u8fdb\u540e\u6548\u679c"),(0,o.kt)("p",null,"CPU Idle \u4e0b\u964d\u5e45\u5ea6\u964d\u4f4e\n",(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662014777027-115887c7-3f45-4920-ac86-386ea965676b.png#clientId=u1e121cd7-cea1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=214&id=u9b9f16de&margin=%5Bobject%20Object%5D&name=image.png&originHeight=378&originWidth=1157&originalType=binary&ratio=1&rotation=0&showTitle=false&size=75312&status=done&style=none&taskId=u0d4cf015-6977-4180-af58-a7e30591c40&title=&width=655.5",alt:"image.png"})),(0,o.kt)("p",null,"\u706b\u7130\u56fe\u4e2d\u7684CPU\u4f7f\u7528\u7387\u51e0\u4e4e\u201c\u6d88\u5931\u201d"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662014826580-a39a6aeb-1aaf-4395-9e86-a52c722a7e93.png#clientId=u1e121cd7-cea1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=284&id=u706b2e3e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=484&originWidth=1146&originalType=binary&ratio=1&rotation=0&showTitle=false&size=413253&status=done&style=none&taskId=ua87d9097-7a43-4975-b0b4-35889169026&title=&width=673",alt:"image.png"})),(0,o.kt)("h1",{id:"4create\u6ce8\u5165\u9636\u6bb5\u4f18\u5316"},"4.create(\u6ce8\u5165)\u9636\u6bb5\u4f18\u5316"),(0,o.kt)("p",null,"\u5728\u5b9e\u9645\u4f7f\u7528\u4e2d\u53d1\u73b0\u6545\u969c\u6ce8\u5165\u5bfc\u81f4CPU Idle\u8dcc\u5e95\u7684\u60c5\u51b5\u6bd4\u8f83\u591a\uff0c\u8dcc\u5e95\u7684\u6301\u7eed\u65f6\u95f4\u662f\u6bd4\u8f83\u77ed\u6682\u7684\u57fa\u672c\u90fd\u572820S\u5de6\u53f3\uff0c\u6709\u4e00\u4e9b\u60c5\u51b5\u662f\u548c\u76ee\u6807\u670d\u52a1\u7684\u4e1a\u52a1\u4ee3\u7801\u6709\u5173\u7cfb\u6216\u8005\u662f\u548c\u76ee\u6807\u670d\u52a1\u7684jvm\u53c2\u6570\u8bbe\u7f6e\u6709\u5173\uff0c\u672c\u6587\u53ea\u4ecb\u7ecd\u7531ChaosBlade\u5bfc\u81f4\u7684\u6216\u95f4\u63a5\u5bfc\u81f4\u7684CPU Idle\u8dcc\u5e95\u95ee\u9898\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662014860747-8535e13d-dfa9-45eb-b9ca-56a51487c8a6.png#clientId=u1e121cd7-cea1-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=203&id=uec06453d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=335&originWidth=1188&originalType=binary&ratio=1&rotation=0&showTitle=false&size=66082&status=done&style=none&taskId=u80bd32f1-7e4c-4bc7-821a-6d0063e4e10&title=&width=719",alt:"image.png"})),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"CPU Idle\u8dcc\u5e95:\u8fd9\u91cc\u6307\u7684\u662fCPU \u7a7a\u95f2\u7387\u964d\u4f4e\u4e3a0\uff0c\u540c\u65f6\u610f\u5473\u7740CPU \u4f7f\u7528\u7387\u8fbe\u5230\u4e86100%")),(0,o.kt)("h2",{id:"41-dubbo\u6545\u969c\u4f18\u5316"},"4.1 dubbo\u6545\u969c\u4f18\u5316"),(0,o.kt)("h3",{id:"411-\u95ee\u9898\u63cf\u8ff0"},"4.1.1 \u95ee\u9898\u63cf\u8ff0"),(0,o.kt)("p",null,"ChaosBlade\u4e2d\u652f\u6301\u5bf9dubbo provider\u6216\u8005consumer\u8fdb\u884c\u6545\u969c\u6ce8\u5165\uff08\u4f8b\u5982\u629b\u5f02\u5e38\uff09\uff0c\u5f53\u4e00\u4e2a\u670d\u52a1\u65e2\u662fprovider\u53c8\u662fconsumer\u7684\u65f6\u5019\uff0c\u5982\u679c\u5bf9provider\u6545\u969c\u6ce8\u5165\u5219\u4f1a\u89e6\u53d1bug\uff0c\u6709\u53ef\u80fd\u4f1a\u5bfc\u81f4CPU Idle\u8dcc\u5e95\u3002"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6b63\u5e38\u60c5\u51b5\uff1a"),"\u4e00\u4e2a\u65e2\u662fprovider\u53c8\u662fconsumer\u7684\u670d\u52a1\uff0c\u5b83\u7684\u8bf7\u6c42\u5904\u7406\u6d41\u7a0b\u662f\u6d41\u91cf\u4f1a\u9996\u5148\u8fdb\u5165\u5230provider\u7ecf\u8fc7\u5904\u7406\u540e\u4ea4\u7531\u4e1a\u52a1\u903b\u8f91\u6267\u884c\uff0c\u6700\u540e\u901a\u8fc7consumer\u5c06\u8bf7\u6c42\u8f6c\u53d1\u51fa\u53bb\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662015356816-ccd9ffd2-8b25-4299-8271-109f11f3af83.png#clientId=u2a5f2d5c-785c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=223&id=ua9805d3c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=446&originWidth=2062&originalType=binary&ratio=1&rotation=0&showTitle=false&size=84435&status=done&style=none&taskId=u363047b1-4e34-4518-ac7d-973c7beb21d&title=&width=1031",alt:"image.png"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u9488\u5bf9consumer\u6545\u969c\u6ce8\u5165\uff1a"),"\u5f53\u5229\u7528ChaosBlade\u5bf9consumer\u8fdb\u884c\u6545\u969c\u6ce8\u5165\u65f6\uff0c\u6d41\u91cf\u5230\u8fbeconsumer\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4e0d\u4f1a\u5c06\u6d41\u91cf\u771f\u6b63\u7684\u8f6c\u53d1\u51fa\u53bb\uff0c\u4ece\u800c\u8fbe\u5230\u4e00\u4e2a\u6a21\u62df\u6545\u969c\u53d1\u751f\u7684\u6548\u679c\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662015418084-149453ef-e51d-4ebf-ae78-ef72bd75c610.png#clientId=u2a5f2d5c-785c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=310&id=u4e441628&margin=%5Bobject%20Object%5D&name=image.png&originHeight=620&originWidth=2080&originalType=binary&ratio=1&rotation=0&showTitle=false&size=109051&status=done&style=none&taskId=u07dd9a40-afa8-4df7-9e7e-a34c5b07b51&title=&width=1040",alt:"image.png"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u9488\u5bf9provider\u6545\u969c\u6ce8\u5165\uff1a"),"\u5f53\u5229\u7528ChaosBlade\u5bf9provider\u8fdb\u884c\u6545\u969c\u6ce8\u5165\u65f6\uff0c\u6d41\u91cf\u5230\u8fbeprovider\u5c31\u4f1a\u629b\u51fa\u5f02\u5e38\uff0c\u4e0d\u4f1a\u5c06\u6d41\u91cf\u5411\u4e0b\u8f6c\u53d1\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662015421125-2b212d41-659f-42b7-af77-75bd47f6a427.png#clientId=u2a5f2d5c-785c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=311&id=uc41e07ca&margin=%5Bobject%20Object%5D&name=image.png&originHeight=622&originWidth=2082&originalType=binary&ratio=1&rotation=0&showTitle=false&size=108382&status=done&style=none&taskId=u5ce1b3ab-81a4-45fb-8850-3fd25e6c4a8&title=&width=1041",alt:"image.png"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u4e0a\u9762\u8bf4\u7684\u90fd\u662f\u9884\u671f\u6548\u679c\uff0c\u5b9e\u9645\u4e0aChaosBlade\u65e0\u8bba\u662f\u5bf9provider\u6216\u8005consumer\u8fdb\u884c\u6545\u969c\u6ce8\u5165\u65f6\uff0c\u90fd\u4f1a\u540c\u65f6provider\u4ee5\u53caconsumer\u540c\u65f6\u8fdb\u884c\u6545\u969c\u6ce8\u5165\uff0c\u8fd9\u5c31\u6709\u53ef\u80fd\u9020\u6210\u989d\u5916\u7684\u8d44\u6e90\u6d6a\u8d39"),"\u3002"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5b57\u8282\u7801\u589e\u5f3a\u7684\u7c7b\u53d8\u7684\u591a\u4e86"),(0,o.kt)("li",{parentName:"ol"},"\u4f8b\u5982\u5f53\u6ce8\u5165provider\u6545\u969c\u65f6\uff0c\u6211\u4eec\u5e0c\u671b\u6d41\u91cf\u4e0d\u8981\u7ecf\u8fc7\u4e1a\u52a1\u903b\u8f91\uff0c\u56e0\u4e3a\u4e00\u65e6\u662f\u5728consumer\u4e5f\u629b\u51fa\u4e86\u5f02\u5e38\uff0c\u6d41\u91cf\u8fd4\u56de\u65f6\u81ea\u7136\u8981\u7ecf\u8fc7\u4e1a\u52a1\u903b\u8f91\u7684\u5f02\u5e38\u5904\u7406\uff08\u4f8b\u5982\u6253\u5370error\u65e5\u5fd7\uff0c\u91cd\u8bd5\u7b49\uff09\uff0c\u8fd9\u5c31\u6709\u53ef\u80fd\u56e0\u4e3a\u4e1a\u52a1\u903b\u8f91\u7684\u5904\u7406\u95ee\u9898\u5bfc\u81f4CPU Idle\u4e0b\u964d\u3002")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662015488924-3b805ca7-7b55-4500-8225-c90e5d7285d6.png#clientId=u2a5f2d5c-785c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=306&id=u4b3c3902&margin=%5Bobject%20Object%5D&name=image.png&originHeight=612&originWidth=2108&originalType=binary&ratio=1&rotation=0&showTitle=false&size=112277&status=done&style=none&taskId=u8fd572bc-c7eb-4e0f-b4cc-3423c81e79a&title=&width=1054",alt:"image.png"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u95ee\u9898\u539f\u56e0:\u56e0\u4e3aChaosBlade\u7684\u5b57\u8282\u7801\u589e\u5f3a\u903b\u8f91\u662f\u6309\u7167\u63d2\u4ef6\u7684\u7c92\u5ea6\u8fdb\u884c\u7684\uff0c\u4f8b\u5982dubbo\u5c31\u5c5e\u4e8e\u4e00\u4e2a\u63d2\u4ef6\uff0c\u4e0d\u8fc7\u50cfdubbo\u548ckafka\u8fd9\u79cd\u65e2\u6709\u9488\u5bf9provider\u53c8\u6709\u9488\u5bf9consumer\u6545\u969c\u6ce8\u5165\u7684\u63d2\u4ef6\u5c31\u4f1a\u540c\u65f6\u5bf9provider\u548cconsumer\u90fd\u6ce8\u5165\u6545\u969c\u4e86\u3002")),(0,o.kt)("h3",{id:"412-\u4f18\u5316"},"4.1.2 \u4f18\u5316"),(0,o.kt)("p",null,"\u5728\u52a0\u8f7d\u63d2\u4ef6\u7684\u65f6\u5019\uff0c\u6839\u636e\u5177\u4f53\u52a0\u8f7d\u7684\u63d2\u4ef6\u540d\u6309\u9700\u52a0\u8f7d\uff0c\u4f8b\u5982\u6267\u884c\u547d\u4ee4:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"./blade create dubbo throwCustomException --provider --exception Java.lang.Exception --service org.apache.dubbo.UserProvider --methodname GetUser \n")),(0,o.kt)("p",null,"\u4ee3\u8868\u5b9e\u9645\u8981\u9488\u5bf9dubbo\u7684provider\u6ce8\u5165\u6545\u969c\uff0c\u90a3\u4e48\u5c31\u53ea\u52a0\u8f7dprovider\u63d2\u4ef6\u8fdb\u884c\u5b57\u8282\u7801\u589e\u5f3a\u3002"),(0,o.kt)("p",null,"\u4fee\u6539\u7684\u6838\u5fc3\u4ee3\u7801\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'private void lazyLoadPlugin(ModelSpec modelSpec, Model model) throws ExperimentException {\n    // ...... \u7701\u7565\n    for (PluginBean pluginBean : pluginBeans.getPluginBeans()) {\n        String flag = model.getMatcher().get(pluginBean.getName());\n        if ("true".equalsIgnoreCase(flag)) {\n            listener.add(pluginBean);\n            break;\n        }\n        listener.add(pluginBean);\n    }\n    // ...... \u7701\u7565\n}\n}\n')),(0,o.kt)("p",null,"\u76f8\u5173pr:",(0,o.kt)("a",{parentName:"p",href:"https://github.com/chaosblade-io/chaosblade-exec-jvm/pull/267"},"https://github.com/ChaosBlade-io/ChaosBlade-exec-jvm/pull/267")),(0,o.kt)("h2",{id:"42-\u81ea\u5b9a\u4e49\u811a\u672c\u6545\u969c\u4f18\u5316"},"4.2 \u81ea\u5b9a\u4e49\u811a\u672c\u6545\u969c\u4f18\u5316"),(0,o.kt)("h3",{id:"421-\u95ee\u9898\u63cf\u8ff0"},"4.2.1 \u95ee\u9898\u63cf\u8ff0"),(0,o.kt)("p",null,"\u5728\u4f7f\u7528ChaosBlade \u6ce8\u5165\u81ea\u5b9a\u4e49\u811a\u672c\u7684\u6545\u969c\u65f6\u5bfc\u81f4CPU Idle\u8dcc\u5e95\uff0c\u81ea\u5b9a\u4e49\u811a\u672c\u662fChaosBlade jvm\u6545\u969c\u4e2d\u652f\u6301\u7684\u4e00\u79cd\u65b9\u5f0f\uff0c\u6307\u7684\u662f\u7528\u6237\u53ef\u4ee5\u7f16\u5199\u4efb\u610f\u4e00\u6bb5Java\u4ee3\u7801\uff0c\u7136\u540e\u5c06\u8fd9\u6bb5\u4ee3\u7801\u6ce8\u5165\u5230\u5bf9\u5e94\u7684\u76ee\u6807\u7c7b\u548c\u65b9\u6cd5\u4e0a\uff0c\u8fd9\u6837\u7684\u65b9\u5f0f\u7075\u6d3b\u5ea6\u975e\u5e38\u9ad8\uff0c\u901a\u8fc7ChaosBlade\u7684\u81ea\u5b9a\u4e49\u811a\u672c\u6ce8\u5165\u6545\u969c\u53ef\u4ee5\u505a\u5f88\u591a\u4e8b\u60c5\u3002"),(0,o.kt)("p",null,"ChaosBlade\u547d\u4ee4:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell"},"./blade c jvm script --classname com.example.xxx.HelloController --methodname Hello --script-content .....\n")),(0,o.kt)("h3",{id:"422-\u95ee\u9898\u6392\u67e5"},"4.2.2 \u95ee\u9898\u6392\u67e5"),(0,o.kt)("p",null,"\u6211\u4eec\u6293\u53d6\u4e86\u6545\u969c\u6ce8\u5165\u65f6\u7684\u706b\u7130\u56fe\u4ee5\u53cajstack\u65e5\u5fd7\uff0c\u901a\u8fc7jstack\u6253\u5370\u7684\u7ebf\u7a0b\u5806\u6808\u53d1\u73b0\u4e86\u4e00\u4e9b\u95ee\u9898\u3002"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5728\u6545\u969c\u6ce8\u5165\u540e\u7ebf\u7a0b\u6570\u91cf\u4f1a\u7a81\u7136\u4e0a\u5347"),(0,o.kt)("li",{parentName:"ol"},"\u6709\u90e8\u5206\u7ebf\u7a0b\u662fblocked\u72b6\u6001")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6545\u969c\u6ce8\u5165\u524d:")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662024346261-4f84e22b-db13-4626-a28d-8bb0edbbed64.png#clientId=u0a32c8ae-289c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=421&id=u3c6a7cd4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=716&originWidth=612&originalType=binary&ratio=1&rotation=0&showTitle=false&size=84822&status=done&style=none&taskId=u0a4730b2-934b-4365-8cf9-509d3a08f42&title=&width=360",alt:"image.png"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u6545\u969c\u6ce8\u5165\u540e:")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662024384319-6c65bb55-30d3-454c-9903-3259db20ada5.png#clientId=u0a32c8ae-289c-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=456&id=uccb4930e&margin=%5Bobject%20Object%5D&name=image.png&originHeight=768&originWidth=612&originalType=binary&ratio=1&rotation=0&showTitle=false&size=97382&status=done&style=none&taskId=ube55edef-27ae-4a7b-91fa-f9c7096278c&title=&width=363",alt:"image.png"})),(0,o.kt)("p",null,"BLOCKED\u7684\u7ebf\u7a0b\u5806\u6808:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"Stack Trace is: \nJava.lang.Thread.State: RUNNABLE\nat Java.util.zip.ZipFile.getEntryTime(Native Method)\nat Java.util.zip.ZipFile.getZipEntry(ZipFile.Java:586)\nat Java.util.zip.ZipFile.access$900(ZipFile.Java:60)\nat Java.util.zip.ZipFile$ZipEntryIterator.next(ZipFile.Java:539)\n- locked <0x00000006c0a57670> (a sun.net.www.protocol.jar.URLJarFile)\nat Java.util.zip.ZipFile$ZipEntryIterator.nextElement(ZipFile.Java:514)\nat Java.util.zip.ZipFile$ZipEntryIterator.nextElement(ZipFile.Java:495)\nat Java.util.jar.JarFile$JarEntryIterator.next(JarFile.Java:258)\nat Java.util.jar.JarFile$JarEntryIterator.nextElement(JarFile.Java:267)\nat Java.util.jar.JarFile$JarEntryIterator.nextElement(JarFile.Java:248)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.Java.JavaCodeScriptEngine$InMemoryJavaFileManager.processJar(JavaCodeScriptEngine.Java:421)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.Java.JavaCodeScriptEngine$InMemoryJavaFileManager.listUnder(JavaCodeScriptEngine.Java:401)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.Java.JavaCodeScriptEngine$InMemoryJavaFileManager.find(JavaCodeScriptEngine.Java:390)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.Java.JavaCodeScriptEngine$InMemoryJavaFileManager.list(JavaCodeScriptEngine.Java:375)\nat com.sun.tools.Javac.api.ClientCodeWrapper$WrappedJavaFileManager.list(ClientCodeWrapper.Java:231)\nat com.sun.tools.Javac.jvm.ClassReader.fillIn(ClassReader.Java:2796)\nat com.sun.tools.Javac.jvm.ClassReader.complete(ClassReader.Java:2446)\nat com.sun.tools.Javac.jvm.ClassReader.access$000(ClassReader.Java:76)\nat com.sun.tools.Javac.jvm.ClassReader$1.complete(ClassReader.Java:240)\nat com.sun.tools.Javac.code.Symbol.complete(Symbol.Java:574)\nat com.sun.tools.Javac.comp.MemberEnter.visitTopLevel(MemberEnter.Java:507)\nat com.sun.tools.Javac.tree.JCTree$JCCompilationUnit.accept(JCTree.Java:518)\nat com.sun.tools.Javac.comp.MemberEnter.memberEnter(MemberEnter.Java:437)\nat com.sun.tools.Javac.comp.MemberEnter.complete(MemberEnter.Java:1038)\nat com.sun.tools.Javac.code.Symbol.complete(Symbol.Java:574)\nat com.sun.tools.Javac.code.Symbol$ClassSymbol.complete(Symbol.Java:1037)\nat com.sun.tools.Javac.comp.Enter.complete(Enter.Java:493)\nat com.sun.tools.Javac.comp.Enter.main(Enter.Java:471)\nat com.sun.tools.Javac.main.JavaCompiler.enterTrees(JavaCompiler.Java:982)\nat com.sun.tools.Javac.main.JavaCompiler.compile(JavaCompiler.Java:857)\nat com.sun.tools.Javac.main.Main.compile(Main.Java:523)\nat com.sun.tools.Javac.api.JavacTaskImpl.doCall(JavacTaskImpl.Java:129)\nat com.sun.tools.Javac.api.JavacTaskImpl.call(JavacTaskImpl.Java:138)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.Java.JavaCodeScriptEngine.compileClass(JavaCodeScriptEngine.Java:149)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.Java.JavaCodeScriptEngine.compile(JavaCodeScriptEngine.Java:113)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.base.AbstractScriptEngineService.doCompile(AbstractScriptEngineService.Java:82)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.base.AbstractScriptEngineService.compile(AbstractScriptEngineService.Java:69)\nat com.alibaba.ChaosBlade.exec.plugin.jvm.script.model.DynamicScriptExecutor.run(DynamicScriptExecutor.Java:74)\nat com.alibaba.ChaosBlade.exec.common.injection.Injector.inject(Injector.Java:73)\nat com.alibaba.ChaosBlade.exec.common.aop.AfterEnhancer.afterAdvice(AfterEnhancer.Java:46)\nat com.alibaba.ChaosBlade.exec.common.plugin.MethodEnhancer.afterAdvice(MethodEnhancer.Java:47)\nat com.alibaba.ChaosBlade.exec.bootstrap.jvmsandbox.AfterEventListener.onEvent(AfterEventListener.Java:93)\nat com.alibaba.jvm.sandbox.core.enhance.weaver.EventListenerHandler.handleEvent(EventListenerHandler.Java:116)\nat com.alibaba.jvm.sandbox.core.enhance.weaver.EventListenerHandler.handleOnEnd(EventListenerHandler.Java:426)\nat com.alibaba.jvm.sandbox.core.enhance.weaver.EventListenerHandler.handleOnReturn(EventListenerHandler.Java:363)\n")),(0,o.kt)("p",null,"\u901a\u8fc7\u7ebf\u7a0b\u5806\u6808\u53ef\u4ee5\u770b\u5230\u7ebf\u7a0b\u4e3b\u8981\u662f\u5728\u89e3\u538bjar\u6587\u4ef6\u662f\u963b\u585e\u4e86\uff0c\u4e3a\u4ec0\u4e48\u4f1a\u963b\u585e\u5230\u8fd9\u91cc\u5462\uff1f"),(0,o.kt)("p",null,"\u5176\u5b9e\u662f\u5728ChaosBlade \u6ce8\u5165\u81ea\u5b9a\u4e49\u811a\u672c\u65f6\uff0c\u81ea\u5b9a\u4e49\u811a\u672c\uff08Java\u4ee3\u7801\uff09\u53ea\u662f\u88ab\u5f53\u4f5c\u4e00\u6bb5\u5b57\u7b26\u4e32\u6765\u5904\u7406\uff0c\u5f53\u771f\u6b63\u7684\u6fc0\u6d3b\u63d2\u4ef6\u65f6\u4f1a\u628a\u8fd9\u6bb5\u5b57\u7b26\u4e32\u89e3\u6790\uff0c\u7136\u540e\u53d8\u6210Java\u4ee3\u7801\u8ba9jvm\u8fdb\u884c\u52a0\u8f7d\u7f16\u8bd1\u5e76\u6267\u884c\u8fd9\u6bb5\u4ee3\u7801\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662024674788-83a1c267-9a95-416b-a84c-c8a8c1ffbb5a.png#clientId=u854e1a66-dc20-4&crop=0&crop=0&crop=1&crop=1&from=ui&id=u15e852b9&margin=%5Bobject%20Object%5D&name=%E8%84%9A%E6%9C%AC%E7%BC%96%E8%AF%91.png&originHeight=666&originWidth=1676&originalType=binary&ratio=1&rotation=0&showTitle=false&size=115604&status=done&style=none&taskId=u046c9be7-044c-44ac-997a-b5d9a724362&title=",alt:"\u811a\u672c\u7f16\u8bd1.png"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u95ee\u9898\u5c31\u5728\u8fd9\u91cc,\u5f53\u6545\u969c\u6ce8\u5165\u65f6\u5916\u90e8\u6d41\u91cf\u4e5f\u662f\u5728\u6e90\u6e90\u4e0d\u65ad\u7684\u8c03\u7528\u5f53\u524d\u670d\u52a1\u7684\u3002\u90a3\u4e48\u6309\u7167\u4e0a\u9762\u8bf4\u7684\u903b\u8f91\u5c31\u6709\u53ef\u80fd\u5728\u6fc0\u6d3b\u63d2\u4ef6\u65f6\uff0c\u56e0\u4e3a\u5916\u90e8\u6d41\u91cf\u4e5f\u5728\u4e0d\u65ad\u8c03\u7528\uff0c\u5bfc\u81f4\u5927\u91cf\u8bf7\u6c42\u90fd\u6765\u89e3\u6790\u81ea\u5b9a\u4e49\u811a\u672c\uff0c\u8fd9\u6837\u7684\u8bdd\u5c31\u9020\u6210\u4e86\u7ebf\u7a0b\u88abblocked\uff0c\u56e0\u4e3a\u89e3\u6790\u81ea\u5b9a\u4e49\u811a\u672c\u5230\u6b63\u786e\u7684\u8ba9jvm\u52a0\u8f7d\u5b83\uff0c\u8fd9\u4e2a\u8fc7\u7a0b\u662f\u76f8\u5bf9\u590d\u6742\u4e14\u7f13\u6162\u7684\uff0c\u800c\u4e14\u6709\u7684\u5730\u65b9\u662f\u8981\u4fdd\u8bc1\u7ebf\u7a0b\u5b89\u5168\u7684\u3002")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5176\u5b9eChaosBlade \u4e5f\u505a\u4e86\u7f13\u5b58\uff0c\u53ea\u8981\u81ea\u5b9a\u4e49\u811a\u672c\u88ab\u7f16\u8bd1\u8fc7\u4e00\u6b21\uff0c\u540e\u9762\u7684\u8bf7\u6c42\u5c31\u4f1a\u76f4\u63a5\u6267\u884c\u8fd9\u4e2a\u811a\u672c\u4e86\uff0c\u4f46\u8fd9\u6837\u7684\u7f13\u5b58\u5728\u5e76\u53d1\u8bf7\u6c42\u7684\u573a\u666f\u4e0b\u7f16\u8bd1\u6548\u679c\u5e76\u4e0d\u597d")),(0,o.kt)("h3",{id:"423-\u4f18\u5316"},"4.2.3 \u4f18\u5316"),(0,o.kt)("p",null,"\u901a\u8fc7\u4e0a\u9762\u7684\u6392\u67e5\uff0c\u5176\u5b9e\u5e94\u8be5\u53ef\u4ee5\u60f3\u5230\u4f18\u5316\u624b\u6bb5\u4e86\uff0c\u90a3\u5c31\u662f\u8981\u8ba9\u81ea\u5b9a\u4e49\u811a\u672c\u7684\u52a0\u8f7d\u65f6\u95f4\u63d0\u524d\u3002"),(0,o.kt)("p",null,"ChaosBlade\u6ce8\u5165\u6545\u969c\u5206\u4e3a\u4e24\u6b65,\u7b2c\u4e00\u6b65\u6302\u8f7dagent\u65f6\u62ff\u4e0d\u5230\u81ea\u5b9a\u4e49\u811a\u672c\u4fe1\u606f\uff0c\u90a3\u4e48\u5c31\u5728\u7b2c\u4e8c\u6b65",(0,o.kt)("strong",{parentName:"p"},"\u6fc0\u6d3b\u63d2\u4ef6\u524d\u8fdb\u884c\u52a0\u8f7d"),"\uff08\u56e0\u4e3a\u4e00\u65e6\u63d2\u4ef6\u88ab\u6fc0\u6d3b\u540e\u5c31\u6709\u6d41\u91cf\u4f1a\u6267\u884c\u5230\u6545\u969c\u6ce8\u5165\u7684\u57cb\u70b9\u65b9\u6cd5\u4ece\u800c\u89e6\u53d1\u811a\u672c\u7684\u7f16\u8bd1\u4e86\uff09"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662024727494-f322ffc3-e397-406e-8d15-370d24673b78.png#clientId=u854e1a66-dc20-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=334&id=ub7fddc91&margin=%5Bobject%20Object%5D&name=image.png&originHeight=668&originWidth=1668&originalType=binary&ratio=1&rotation=0&showTitle=false&size=119885&status=done&style=none&taskId=uaf619068-ab50-4976-8b63-5af78a7b60b&title=&width=834",alt:"image.png"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u8fd9\u4e2a\u4f18\u5316\u601d\u8def\u4e0d\u4ec5\u4ec5\u9002\u7528\u4e8e\u81ea\u5b9a\u4e49\u811a\u672c\u6545\u969c\uff0c\u4f8b\u5982\u81ea\u5b9a\u4e49\u629b\u5f02\u5e38\u6545\u969c\u4e5f\u662f\u53ef\u4ee5\u7684\u3002")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u5728\u81ea\u5b9a\u4e49\u629b\u5f02\u5e38\u7684\u6545\u969c\u6267\u884c\u4e2d\uff0c\u4e5f\u662f\u5f53\u6d41\u91cf\u8fc7\u6765\u65f6\u624d\u4f1a\u6839\u636e\u7528\u6237\u8f93\u5165\u7684\u5f02\u5e38\u7c7b\u5b57\u7b26\u8fdb\u884c\u53cd\u5c04\u52a0\u8f7d\uff0c\u7c7b\u7684\u52a0\u8f7d(classloader)\u5e95\u5c42\u4e5f\u662f\u9700\u8981\u52a0\u9501\u7684\uff0c\u6240\u4ee5\u4e5f\u6709\u53ef\u80fd\u9020\u6210\u7ebf\u7a0bblocked.")),(0,o.kt)("p",null,"\u4f18\u5316\u5185\u5bb9:\u589e\u52a0\u6545\u969c\u524d\u7f6e\u6267\u884c\u63a5\u53e3\uff0c\u9488\u5bf9\u9700\u8981\u5728\u6545\u969c\u6ce8\u5165\u524d\uff0c\u6267\u884c\u67d0\u4e9b\u52a8\u4f5c\u7684\u63d2\u4ef6\u53ef\u4ee5\u53bb\u5b9e\u73b0\u5b83\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"public interface PreActionExecutor {\n    /**\n     * Pre run executor\n     *\n     * @param enhancerModel\n     * @throws Exception\n     */\n    void preRun(EnhancerModel enhancerModel) throws ExperimentException;\n}\n\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"private void applyPreActionExecutorHandler(ModelSpec modelSpec, Model model)\n        throws ExperimentException {\n    ActionExecutor actionExecutor = modelSpec.getActionSpec(model.getActionName()).getActionExecutor();\n    if (actionExecutor instanceof PreActionExecutor) {\n        EnhancerModel enhancerModel = new EnhancerModel(EnhancerModel.class.getClassLoader(), model.getMatcher());\n        enhancerModel.merge(model);\n        ((PreActionExecutor) actionExecutor).preRun(enhancerModel);\n    }\n}\n")),(0,o.kt)("p",null,"\u76f8\u5173pr:",(0,o.kt)("a",{parentName:"p",href:"https://github.com/chaosblade-io/chaosblade-exec-jvm/pull/269"},"https://github.com/ChaosBlade-io/ChaosBlade-exec-jvm/pull/269")),(0,o.kt)("h2",{id:"43-\u65e5\u5fd7\u6253\u5370\u4f18\u5316"},"4.3 \u65e5\u5fd7\u6253\u5370\u4f18\u5316"),(0,o.kt)("h3",{id:"431-\u95ee\u9898\u63cf\u8ff0"},"4.3.1 \u95ee\u9898\u63cf\u8ff0"),(0,o.kt)("p",null,"\u65e5\u5fd7\u6253\u5370\u5bfc\u81f4\u7684CPU Idle\u8dcc\u5e95\u95ee\u9898\u4e3b\u8981\u6709\u4e24\u65b9\u9762:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4e1a\u52a1\u7cfb\u7edf\u5185\u90e8\u81ea\u8eab\u7684\u65e5\u5fd7\u6846\u67b6\uff0c\u4f8b\u5982\u4f7f\u7528log4j/logback\u540c\u6b65\u65e5\u5fd7\u6253\u5370\uff0c\u5982\u679c\u5728\u6ce8\u5165\u6545\u969c\u540e\uff08\u4f8b\u5982\u629b\u5f02\u5e38\uff09",(0,o.kt)("strong",{parentName:"li"},"\u5f88\u6709\u53ef\u80fd\u56e0\u4e3a\u4e1a\u52a1\u7cfb\u7edf\u5904\u7406\u5f02\u5e38\u5e76\u6253\u5370\u65e5\u5fd7\u5bfc\u81f4\u7ebf\u7a0b\u5927\u9762\u79ef\u88abblocked\u3002"),"\u56e0\u4e3a\u540c\u6b65\u65e5\u5fd7\u6253\u5370\u662f\u9700\u8981\u52a0\u9501\u5904\u7406\uff0c\u5e76\u4e14\u5f02\u5e38\u5806\u6808\u662f\u76f8\u5bf9\u5185\u5bb9\u8f83\u591a\u7684\u6253\u5370\u4e5f\u76f8\u5bf9\u8017\u65f6\uff0c\u4ece\u800c\u5f53QPS\u8f83\u9ad8\u65f6\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf\u7ebf\u7a0b\u88ab\u963b\u585e\u3002")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"- locked <0x00000006f08422d0> (a org.apache.log4j.DailyRollingFileAppender)\nat org.apache.log4j.helpers.AppenderAttachableImpl.appendLoopOnAppenders(AppenderAttachableImpl.Java:66)\nat org.apache.log4j.Category.callAppenders(Category.Java:206)\n- locked <0x00000006f086daf8> (a org.apache.log4j.Logger)\nat org.apache.log4j.Category.forcedLog(Category.Java:391)\nat org.apache.log4j.Category.log(Category.Java:856)\nat org.slf4j.impl.Log4jLoggerAdapter.log(Log4jLoggerAdapter.Java:601)\n")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662024805257-1df804ba-b2f4-4718-b85f-576efda49d21.png#clientId=u854e1a66-dc20-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=307&id=u7fc7ec6d&margin=%5Bobject%20Object%5D&name=image.png&originHeight=435&originWidth=612&originalType=binary&ratio=1&rotation=0&showTitle=false&size=115307&status=done&style=none&taskId=u0fc9e5fd-9ce3-4d99-971d-b9c08f05cd2&title=&width=432",alt:"image.png"})),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"ChaosBlade \u81ea\u8eab\u7684\u65e5\u5fd7\u6253\u5370,\u6bcf\u6b21\u6545\u969c\u6ce8\u5165\u89c4\u5219\u5339\u914d\u6210\u529f\u65f6\u90fd\u4f1a\u8f93\u51fainfo\u65e5\u5fd7")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'LOGGER.info("Match rule: {}", JsonUtil.writer().writeValueAsString(model));\n')),(0,o.kt)("p",null,"\u5728\u8f93\u51fa\u65e5\u5fd7\u7684\u65f6\u5019\u90fd\u4f1a\u5c06\u6545\u969c\u6a21\u578b\u4f7f\u7528jackson\u5e8f\u5217\u5316\u8f93\u51fa,\u8fd9\u4f1a\u89e6\u53d1\u7c7b\u52a0\u8f7d\uff08\u52a0\u9501\u64cd\u4f5c\uff09\u5f53\u6709\u5927\u91cf\u8bf7\u6c42\u65f6\u53ef\u80fd\u4f1a\u5bfc\u81f4\u5927\u91cf\u7ebf\u7a0b\u963b\u585e\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"Java.lang.Thread.State: RUNNABLE\nat Java.lang.String.charAt(String.Java:657)\nat Java.io.UnixFileSystem.normalize(UnixFileSystem.Java:87)\nat Java.io.File.<init>(File.Java:279)\nat sun.net.www.protocol.file.Handler.openConnection(Handler.Java:80)\n- locked <0x00000000c01f2740> (a sun.net.www.protocol.file.Handler)\nat sun.net.www.protocol.file.Handler.openConnection(Handler.Java:72)\n- locked <0x00000000c01f2740> (a sun.net.www.protocol.file.Handler)\nat Java.net.URL.openConnection(URL.Java:979)\nat sun.net.www.protocol.jar.JarFileFactory.getConnection(JarFileFactory.Java:65)\nat sun.net.www.protocol.jar.JarFileFactory.getPermission(JarFileFactory.Java:154)\nat sun.net.www.protocol.jar.JarFileFactory.getCachedJarFile(JarFileFactory.Java:126)\nat sun.net.www.protocol.jar.JarFileFactory.get(JarFileFactory.Java:81)\n- locked <0x00000000c00171f0> (a sun.net.www.protocol.jar.JarFileFactory)\nat sun.net.www.protocol.jar.JarURLConnection.connect(JarURLConnection.Java:122)\nat sun.net.www.protocol.jar.JarURLConnection.getInputStream(JarURLConnection.Java:152)\nat Java.net.URL.openStream(URL.Java:1045)\nat Java.lang.ClassLoader.getResourceAsStream(ClassLoader.Java:1309)\n......\nat Java.lang.reflect.Method.invoke(Method.Java:498)\nat com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.Java:689)\nat com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.Java:755)\nat com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.Java:178)\nat com.fasterxml.jackson.databind.ser.BeanPropertyWriter.serializeAsField(BeanPropertyWriter.Java:728)\nat com.fasterxml.jackson.databind.ser.std.BeanSerializerBase.serializeFields(BeanSerializerBase.Java:755)\nat com.fasterxml.jackson.databind.ser.BeanSerializer.serialize(BeanSerializer.Java:178)\nat com.fasterxml.jackson.databind.ser.DefaultSerializerProvider._serialize(DefaultSerializerProvider.Java:480)\nat com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.Java:319)\nat com.fasterxml.jackson.databind.ObjectWriter$Prefetch.serialize(ObjectWriter.Java:1516)\nat com.fasterxml.jackson.databind.ObjectWriter._writeValueAndClose(ObjectWriter.Java:1217)\nat com.fasterxml.jackson.databind.ObjectWriter.writeValueAsString(ObjectWriter.Java:1086)\nat com.alibaba.ChaosBlade.exec.common.injection.Injector.inject(Injector.Java:69)\nat com.alibaba.ChaosBlade.exec.common.aop.AfterEnhancer.afterAdvice(AfterEnhancer.Java:46)\nat com.alibaba.ChaosBlade.exec.common.plugin.MethodEnhancer.afterAdvice(MethodEnhancer.Java:47)\nat com.alibaba.ChaosBlade.exec.bootstrap.jvmsandbox.AfterEventListener.onEvent(AfterEventListener.Java:93)\nat com.alibaba.jvm.sandbox.core.enhance.weaver.EventListenerHandler.handleEvent(EventListenerHandler.Java:116)\nat com.alibaba.jvm.sandbox.core.enhance.weaver.EventListenerHandler.handleOnEnd(EventListenerHandler.Java:426)\nat com.alibaba.jvm.sandbox.core.enhance.weaver.EventListenerHandler.handleOnReturn(EventListenerHandler.Java:363)\nat Java.com.alibaba.jvm.sandbox.spy.Spy.spyMethodOnReturn(Spy.Java:192)\n\n")),(0,o.kt)("h3",{id:"432-\u4f18\u5316"},"4.3.2 \u4f18\u5316"),(0,o.kt)("p",null,"\u5173\u4e8e\u4e1a\u52a1\u7cfb\u7edf\u7684\u65e5\u5fd7\u6253\u5370\u5f15\u53d1\u7684\u7ebf\u7a0bblock\uff0c\u4e0d\u5728ChaosBlade\u4f18\u5316\u7684\u8303\u56f4\u5185\uff0c\u5927\u5bb6\u6709\u9047\u5230\u7c7b\u4f3c\u60c5\u51b5\u53ef\u4ee5\u81ea\u884c\u89e3\u51b3\u3002"),(0,o.kt)("p",null,"\u89e3\u51b3\u7684\u601d\u8def:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u65e5\u5fd7\u540c\u6b65\u6253\u5370\u6539\u4e3a\u5f02\u6b65\u6253\u5370"),(0,o.kt)("li",{parentName:"ol"},"ChaosBlade\u81ea\u5b9a\u4e49\u629b\u5f02\u5e38\u65f6\u7684\u9519\u8bef\u5806\u6808\u53ef\u4ee5\u5c3d\u91cf\u5ffd\u7565\uff0c\u51cf\u5c11\u65e5\u5fd7\u8f93\u51fa\u7684\u5185\u5bb9\u3002")),(0,o.kt)("p",null,"\u5173\u4e8eChaosBlade \u6253\u5370\u65e5\u5fd7\u7684\u4f18\u5316\u5c31\u6bd4\u8f83\u7b80\u5355\u4e86\uff0c\u53ea\u9700\u8981\u5c06match rule\u5e8f\u5217\u5316\u6545\u969c\u6a21\u578b\u7684\u90e8\u5206\u66ff\u6362\u6389\u5373\u53ef\u3002\u5c06Model\u5b9e\u73b0toString\uff0c\u6253\u5370\u65f6\u76f4\u63a5\u6253\u5370Model\u5373\u53ef\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'LOGGER.info("Match rule: {}", model);\n')),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},'@Override\npublic String toString() {\n    return "Model{" +\n            "target=\'" + target + \'\\\'\' +\n            ", matchers=" + matcher.getMatchers().toString() +\n            ", action=" + action.getName() +\n            \'}\';\n}\n')),(0,o.kt)("p",null,"\u76f8\u5173pr:",(0,o.kt)("a",{parentName:"p",href:"https://github.com/chaosblade-io/chaosblade-exec-jvm/pull/260"},"https://github.com/ChaosBlade-io/ChaosBlade-exec-jvm/pull/260")),(0,o.kt)("h1",{id:"5metaspace-oom\u4f18\u5316"},"5.Metaspace OOM\u4f18\u5316"),(0,o.kt)("p",null,"Metaspace \u662f\u4ec0\u4e48\uff0c\u5f15\u7528\u5b98\u65b9\u4ecb\u7ecd"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"Metaspace is a native (as in: off-heap) memory manager in the hotspot.\nIt is used to manage memory for class metadata. Class metadata are allocated when classes are loaded. \nTheir lifetime is usually scoped to that of the loading classloader - when a loader gets collected, all class metadata it accumulated are released in bulk.\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u7b80\u5355\u6765\u8bf4\uff1aMetapace \u662f\u4e00\u5757\u975e\u5806\u5185\u5b58\uff0c\u7528\u6765\u5b58\u50a8\u7c7b\u7684\u5143\u6570\u636e\uff0c\u5f53\u52a0\u8f7d\u7c7b\u7684\u65f6\u5019\u4f1a\u5728 Metaspace \u4e2d\u5206\u914d\u7a7a\u95f4\u5b58\u50a8\u7c7b\u7684\u5143\u6570\u636e\uff0c\u5f53\u67d0\u4e2a ClassLoader \u5173\u95ed\u65f6\u4f1a\u5bf9\u5e94\u91ca\u653e\u6389\u5bf9\u7c7b\u5143\u6570\u636e\u7684\u5f15\u7528\uff0c\u5f53\u89e6\u53d1 GC \u65f6\u8fd9\u90e8\u5206\u7c7b\u5143\u6570\u636e\u5360\u7528\u7684\u7a7a\u95f4\u5373\u53ef\u5728 Metaspace \u4e2d\u88ab\u56de\u6536\u6389\u3002")),(0,o.kt)("h2",{id:"51-\u73b0\u8c61"},"5.1 \u73b0\u8c61"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u65e5\u5fd7\u8868\u73b0")),(0,o.kt)("p",null,"\u5728\u4f7f\u7528ChaosBlade\u6ce8\u5165\u65e0\u6548\u540e\uff0c\u767b\u9646\u76ee\u6807\u673a\u5668\u4e0a\u89c2\u5bdf\u65e5\u5fd7\uff0c\u9996\u5148\u53d1\u73b0 jvm-sandbox \u5728 attach \u76ee\u6807 jvm \u65f6\u5931\u8d25"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662025134235-ccc6d0c6-f059-4024-8b21-e6f108ef0d4e.png#clientId=u854e1a66-dc20-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=146&id=u252466f4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=291&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=565948&status=done&style=none&taskId=u6ffeaa9f-3222-47f4-b5ee-9e6f0eab537&title=&width=960",alt:"image.png"})),(0,o.kt)("p",null,"\u5176\u6b21\u770b\u5230\u66f4\u5173\u952e\u7684\u65e5\u5fd7:Metaspace \u6ea2\u51fa\u4e86\uff01\uff01\uff01"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662025159003-cbe3e050-32c9-4cea-8bfb-b3950170f51c.png#clientId=u854e1a66-dc20-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=343&id=u74144a61&margin=%5Bobject%20Object%5D&name=image.png&originHeight=686&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1121123&status=done&style=none&taskId=u9e3ca2a4-cdec-419c-ab47-d1dfa4a9426&title=&width=960",alt:"image.png"})),(0,o.kt)("h2",{id:"52-\u5b9a\u4f4d"},"5.2 \u5b9a\u4f4d"),(0,o.kt)("p",null,"\u5728\u6587\u7ae0\u5f00\u59cb\u4ecb\u7ecd\u4e86ChaosBlade\u6ce8\u5165Java\u6545\u969c\u7684\u6d41\u7a0b\uff0c\u77e5\u9053\u5728\u6545\u969c\u6ce8\u5165\u65f6\u4f1a\u5c06 jvm-sandbox \u52a8\u6001\u7684\u6302\u8f7d(attach)\u5230\u76ee\u6807\u8fdb\u7a0b JVM \u4e0a,\u5728 attach \u540e\u4f1a\u52a0\u8f7d sandbox \u5185\u90e8 jar \u4ee5\u53ca sandbox \u7684\u81ea\u5b9a\u4e49\u6a21\u5757 jar \u7b49\uff0c\u5728\u8fd9\u4e2a\u8fc7\u7a0b\u4e2d\u4f1a\u52a0\u8f7d\u5927\u91cf\u7684\u7c7b\uff0c\u5f53\u52a0\u8f7d\u7c7b\u65f6\u4f1a\u5206\u914d Metaspace \u7a7a\u95f4\u5b58\u50a8\u7c7b\u7684\u5143\u6570\u636e\u3002"),(0,o.kt)("p",null,"\u8fd9\u91cc\u6709\u4e24\u4e2a\u601d\u8003\u70b9:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"\u4f1a\u4e0d\u4f1a\u662f\u56e0\u4e3a\u4e1a\u52a1\u670d\u52a1 JVM \u7684 Metaspace \u7a7a\u95f4\u8bbe\u7f6e\u7684\u592a\u5c0f\uff1f")),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Metaspace \u7684 GC \u6ca1\u6709\u89e6\u53d1\u6216\u8005\u662f\u6709\u6cc4\u9732\u5bfc\u81f4\u7c7b\u7684\u5143\u6570\u636e\u56de\u6536\u4e0d\u6389\uff1f"))),(0,o.kt)("p",null,"\u767b\u9646\u5230\u76ee\u6807\u673a\u5668\u4e0a\u5229\u7528 jinfo \u89c2\u5bdf jvm \u7684\u53c2\u6570,\u53d1\u73b0 MaxMetaspaceSize \u8bbe\u7f6e\u4e86 128M\uff0c\u8fd9\u4e2a\u503c\u786e\u5b9e\u4e0d\u5927\uff0c\u56e0\u4e3a MaxMetaspaceSize \u7684\u9ed8\u8ba4\u662f-1(\u65e0\u9650\u5236\uff0c\u53d7\u9650\u4e8e\u672c\u5730\u5185\u5b58)\u3002"),(0,o.kt)("p",null,"\u8ba9\u4e1a\u52a1\u670d\u52a1\u8c03\u6574 MaxMetaspaceSize \u53c2\u6570\u6539\u4e3a 256M\uff0c\u7136\u540e\u91cd\u542f Java \u8fdb\u7a0b\uff0c\u518d\u6b21\u6545\u969c\u6ce8\u5165 \u786e\u5b9e\u6ca1\u95ee\u9898\u4e86\uff0c\u6545\u969c\u6b63\u5e38\u751f\u6548\u4e86\u3002"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u4f46\u5b9e\u9645\u95ee\u9898\u6ca1\u600e\u4e48\u7b80\u5355\uff0c\u5728\u8fde\u7eed\u6ce8\u5165\u591a\u6b21\u540e\u4f9d\u7136\u51fa\u73b0 Metaspace OOM \u6545\u969c\u4f9d\u65e7\u65e0\u6548\u3002\u770b\u6765\u5e94\u8be5\u662f\u6545\u969c\u6e05\u9664\u65f6\u65e0\u6cd5\u56de\u6536\u6389 Metaspace \u4e2d\u5bf9\u5e94\u7684\u7a7a\u95f4\u3002")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u672c\u5730\u590d\u73b0")),(0,o.kt)("p",null,"\u7531\u4e8eChaosBlade Java\u6545\u969c\u6ce8\u5165\u672c\u8d28\u662fjvm-sandbox\u7684\u4e00\u4e2a\u63d2\u4ef6\uff0c\u7c7b\u52a0\u8f7d\uff0c\u5b57\u8282\u7801\u589e\u5f3a\u7b49\u6838\u5fc3\u903b\u8f91\u90fd\u5728jvm-sandebox\u4e0a\uff0c\u6240\u4ee5\u6211\u4eec\u76f4\u63a5\u5c06\u95ee\u9898\u5b9a\u4f4d\u5728jvm-sandbox\u4e0a\uff0c\u5229\u7528jvm-sandbox\u63d0\u4f9b\u7684demo\u9879\u76ee\u8fdb\u884c\u590d\u73b0\u3002"),(0,o.kt)("p",null,"\u542f\u52a8\u53c2\u6570\u8bbe\u7f6e\u4e86 MaxMetaspaceSize=30M\uff0c\u56e0\u4e3a demo \u6a21\u5757\u7c7b\u975e\u5e38\u5c11\uff0c\u5176\u6b21\u4e3a\u4e86\u5feb\u901f\u7684\u590d\u73b0 OOM\u3002"),(0,o.kt)("p",null,"TraceClassLoading \u548c TraceClassUnloding \u53c2\u6570\u5219\u662f\u4e3a\u4e86\u89c2\u5bdf JVM-SANDBOX \u5728\u6545\u969c\u6ce8\u5165\u548c\u6e05\u9664\u65f6\u52a0\u8f7d/\u5378\u8f7d\u7c7b\u7684\u4fe1\u606f\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662025224907-466c59fa-2368-42ac-b8d0-310a69b2dc3f.png#clientId=u4157e217-e5f5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=392&id=ub4ebcc30&margin=%5Bobject%20Object%5D&name=image.png&originHeight=784&originWidth=1420&originalType=binary&ratio=1&rotation=0&showTitle=false&size=110130&status=done&style=none&taskId=u3515020a-9a7c-4358-94e5-8d9ce0b9432&title=&width=710",alt:"image.png"})),(0,o.kt)("p",null,"\u5728\u591a\u6b21\u6ce8\u5165\u4ee5\u53ca\u6e05\u9664\u7684\u64cd\u4f5c\u540e\uff0c\u590d\u73b0\u4e86\u7ebf\u4e0a\u4e1a\u52a1\u51fa\u73b0\u7684 Metaspace OOM\uff0c\u53ef\u4ee5\u770b\u5230\u5728\u591a\u6b21\u6ce8\u5165\u7684\u8fc7\u7a0b\u4e2d\uff0cMetaspace \u4e00\u76f4\u6ca1\u6709\u88ab\u56de\u6536\u8fc7\uff0c\u5360\u7528\u7a7a\u95f4\u66f2\u7ebf\u662f\u4e00\u8def\u4e0a\u5347\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662025257540-54ad0e55-7bbb-4d6b-b974-254e786d8a72.png#clientId=u4157e217-e5f5-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=661&id=u548266fd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1321&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=200347&status=done&style=none&taskId=uab1cb32a-8508-4f99-8943-d602ae934ed&title=&width=960",alt:"image.png"})),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Metaspace OOM \u662f\u56e0\u4e3a Metaspace \u6ca1\u6709\u8fdb\u884c\u8fc7\u56de\u6536\uff0cMetaspace \u56de\u6536\u7684\u524d\u63d0\u662f ClassLoader \u5173\u95ed\uff0c\u800c JVM-SANDBOX \u5728 shutdown \u65f6\u4f1a\u5173\u95ed ClassLoader\u3002JVM-SANDBOX \u4e2d\u81ea\u5b9a\u4e49\u7684 ClassLoader \u90fd\u662f\u7ee7\u627f\u4e86 URLClassLoader\uff0cURLClassLoader \u7684\u5173\u95ed\u65b9\u6cd5 \u5b98\u65b9\u4ecb\u7ecd\uff1a")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"How to Close a URLClassLoader?\nThe URLClassLoader close() method effectively eliminates the problem of how to support updated implementations of the classes and resources loaded from a particular codebase, and in particular from JAR files. In principle, once the application clears all references to a loader object, the garbage collector and finalization mechanisms will eventually ensure that all resources (such as the JarFile objects) are released and closed.\n")),(0,o.kt)("p",null,"\u7b80\u5355\u6765\u8bf4\uff1a\u5f53 classLoader \u52a0\u8f7d\u7684\u6240\u6709\u7c7b\u6ca1\u6709\u88ab\u5f15\u7528\u65f6\u5373\u53ef\u88ab\u5173\u95ed\u3002"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u731c\u60f3"),"\n",(0,o.kt)("strong",{parentName:"p"},"\u5f53\u6545\u969c\u6e05\u9664\u65f6 jvm-sandbox \u4e2d\u7684\u7c7b\u8fd8\u6709\u88ab\u5f15\u7528\u7684\u60c5\u51b5\u5bfc\u81f4 classloader \u5173\u95ed\u5931\u8d25\u4e86\u3002")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u9a8c\u8bc1\u731c\u60f3"),"\n",(0,o.kt)("strong",{parentName:"p"},"\u5728\u6545\u969c\u6e05\u9664\u540e\uff0c\u5728\u76ee\u6807\u670d\u52a1\u7684\u65b9\u6cd5\u4e0a debug \u770b\u4e00\u4e0b\u7ebf\u7a0b\u4fe1\u606f\uff0c\u679c\u7136\u5728 threadLocal \u4e2d\u627e\u5230\u4e86\u4e24\u4e2a jvm-sandbox \u7684\u5185\u90e8\u7c7b\uff08EventProcesser$Process,SandboxProtector\uff09\u7684\u5f15\u7528\u3002\u8bf4\u660e\u731c\u60f3\u662f\u5bf9\u7684\uff0c\u95ee\u9898\u7684\u539f\u56e0\u5c31\u662f\u51fa\u73b0\u5728\u8fd9\u91cc\u4e86")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662025409608-049339d0-4065-4e90-b6de-d27fd125b5f6.png#clientId=u90f09cf4-59dc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=662&id=u56284955&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1324&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=677495&status=done&style=none&taskId=u3ddb2694-e1f6-4055-870b-c894ab9c7a5&title=&width=960",alt:"image.png"})),(0,o.kt)("p",null,"jvm-sandbox\u6e90\u7801\u5728\u8fd9\u91cc\u5c31\u4e0d\u5e26\u5927\u5bb6\u5206\u6790\u4e86\uff0c\u611f\u5174\u8da3\u7684\u53ef\u4ee5\u67e5\u770b\u8fd9\u7bc7",(0,o.kt)("a",{parentName:"p",href:"https://xie.infoq.cn/article/c5be9834709f7eb48cfa683b1"},"\u6587\u7ae0"),"\u3002\u4e3b\u8981\u662f jvm-sandbox \u7684\u4ee3\u7801\u5b9e\u73b0\u6709 bug\uff0c\u5728\u4ee5\u4e0b\u4e24\u79cd\u60c5\u51b5\u4f1a\u5bfc\u81f4 processRef \u7684 ThreadLocal \u6ca1\u6709\u53ca\u65f6 remove \u9020\u6210\u6cc4\u6f0f"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5047\u5982\u5728\u6267\u884c\u6ce8\u5165\u6545\u969c\u7684\u8fc7\u7a0b\u4e2d\uff0c\u8fdb\u884c\u6545\u969c\u6e05\u9664\u4f1a\u5bfc\u81f4\u6cc4\u6f0f\u3002\u5982\u4e0b\uff1a")),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662025438733-39f99d72-7d45-477d-8bae-1b4fe23fa0db.png#clientId=u90f09cf4-59dc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=612&id=u5597fc7a&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1224&originWidth=1556&originalType=binary&ratio=1&rotation=0&showTitle=false&size=1398788&status=done&style=none&taskId=ud0fe7ed4-f453-4fdb-b725-562334731c6&title=&width=778",alt:"image.png"})),(0,o.kt)("ol",{start:2},(0,o.kt)("li",{parentName:"ol"},"\u5047\u8bbe\u4f7f\u7528\u4e86 jvm-sandbox \u7684\u7279\u6027-\u6d41\u7a0b\u53d8\u66f4\uff08\u4f8b\u5982\u7acb\u5373\u8fd4\u56de\uff0c\u7acb\u5373\u629b\u51fa\u5f02\u5e38\uff09\uff0c\u672c\u8d28\u4e5f\u662f thread local \u6ca1\u6709\u53ca\u65f6 remove\uff0c\u5bfc\u81f4\u9020\u6210\u4e86\u6cc4\u6f0f")),(0,o.kt)("h2",{id:"53-\u4f18\u5316"},"5.3 \u4f18\u5316"),(0,o.kt)("p",null,"\u7531\u4e8ejvm-sandbox\u9879\u76ee\u5df2\u7ecf\u4e0d\u5728\u6d3b\u8dc3\u4e86\uff0c\u6211\u4eec\u5c06jvm-sandbox\u9879\u76eefork\u5230\u4e86ChaosBlade\u4e2d\u3002\n\u4f18\u5316\u540e\u7684\u76f8\u5173pr:",(0,o.kt)("a",{parentName:"p",href:"https://github.com/chaosblade-io/jvm-sandbox/pull/1"},"https://github.com/ChaosBlade-io/jvm-sandbox/pull/1")),(0,o.kt)("h2",{id:"54-\u6539\u8fdb\u540e\u6548\u679c"},"5.4 \u6539\u8fdb\u540e\u6548\u679c"),(0,o.kt)("p",null,"\u542f\u52a8\u53c2\u6570\u8fd8\u662f\u76f8\u540c\u7684 MaxMetaspaceSize=30M\uff0c\u7ecf\u8fc7\u4f18\u5316\u540e\u591a\u6b21\u6ce8\u5165\u548c\u6e05\u9664\u4e0d\u4f1a\u51fa\u73b0 Metaspace OOM\uff0cMetaspace\u53ef\u4ee5\u88ab\u56de\u6536\u4e86\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662025496836-b6895072-2d92-46ea-ba0f-59ab65035aff.png#clientId=u90f09cf4-59dc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=638&id=u39968c09&margin=%5Bobject%20Object%5D&name=image.png&originHeight=1275&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=143820&status=done&style=none&taskId=ub9a9c81b-5e4b-42d7-942a-51a6015c5c6&title=&width=960",alt:"image.png"})),(0,o.kt)("p",null,"\u5378\u8f7d\u7c7b\u7684\u4fe1\u606f\u4e5f\u6253\u5370\u51fa\u6765\u4e86"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662025512805-62c158bc-61fc-4443-befd-b10445f9fb92.png#clientId=u90f09cf4-59dc-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=344&id=u051ce70b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=687&originWidth=1920&originalType=binary&ratio=1&rotation=0&showTitle=false&size=344964&status=done&style=none&taskId=uebfee1f3-f546-47a5-a96e-0725dace717&title=&width=960",alt:"image.png"})),(0,o.kt)("h2",{id:"54-\u518d\u6b21\u4f18\u5316"},"5.4 \u518d\u6b21\u4f18\u5316"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u867d\u7136\u6211\u4eec\u89e3\u51b3\u4e86JVM-Sandbox\u7684ThreadLocal\u6cc4\u6f0f\u95ee\u9898\uff0c\u4f46\u662f\u7531\u4e8eMetaspace\u7684\u5185\u5b58\u5206\u914d\u4ee5\u53ca\u56de\u6536\u673a\u5236\u8fd8\u662f\u6709\u53ef\u80fd\u5bfc\u81f4OOM!!!.")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"\u5173\u4e8eMetaspace\u7684\u5185\u5b58\u5206\u914d\u4ee5\u53ca\u56de\u6536\u7684\u76f8\u5173\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003"),(0,o.kt)("a",{parentName:"p",href:"https://www.javadoop.com/post/metaspace"},"\u6587\u7ae0"))),(0,o.kt)("p",null,"\u4e0a\u9762\u7684\u4f18\u5316\u57fa\u7840\u4e0a\u8fd8\u9700\u8981\u5728\u6bcf\u4e00\u6b21\u6545\u969c\u6ce8\u5165\u524d\u89e6\u53d1\u4e00\u6b21full gc\uff0c\u76ee\u7684\u662f\u8ba9\u4e0a\u4e00\u6b21jvm-sandbox\u5360\u7528\u7684\u5143\u7a7a\u95f4\u5f3a\u5236\u91ca\u653e\u6389\u3002"),(0,o.kt)("p",null,"\u6539\u52a8\u70b9:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-java"},"public static void agentmain(String featureString, Instrumentation inst) {\n    System.gc();\n    LAUNCH_MODE = LAUNCH_MODE_ATTACH;\n    final Map<String, String> featureMap = toFeatureMap(featureString);\n    writeAttachResult(\n            getNamespace(featureMap),\n            getToken(featureMap),\n            install(featureMap, inst)\n    );\n}\n")),(0,o.kt)("p",null,"\u8fd9\u6837\u7684\u6539\u52a8\u7684\u867d\u7136\u80fd\u89e3\u51b3\u4e00\u90e8\u5206\u573a\u666f\u4e0b\u7684Metaspace OOM\uff0c\u4f46\u662f\u4e5f\u6709\u5f0a\u7aef,\u8fd9\u6837\u4f1a\u5bfc\u81f4\u6bcf\u4e00\u6b21\u6545\u969c\u6ce8\u5165\u6302\u8f7dagent\u65f6\u90fd\u4f1a\u89e6\u53d1\u4e00\u6b21full GC,\u5230\u76ee\u524d\u4e3a\u6b62\u8fd8\u6ca1\u6709\u66f4\u597d\u7684\u89e3\u51b3\u529e\u6cd5\uff0c\u540e\u9762\u53ef\u4ee5\u8003\u8651\u5c06\u8fd9\u4e2afull gc\u505a\u6210\u914d\u7f6e\uff0c\u901a\u8fc7sandbox\u811a\u672c\u6765\u8fdb\u884c\u5f00\u542f\uff0c\u8ba9\u7528\u6237\u6309\u9700\u9009\u62e9\u662f\u5426\u8981\u5728\u6ce8\u5165\u524d\u5f3a\u5236full gc\u4e00\u6b21\u3002"),(0,o.kt)("p",null,"\u76f8\u5173pr:",(0,o.kt)("a",{parentName:"p",href:"https://github.com/chaosblade-io/jvm-sandbox/pull/6"},"https://github.com/ChaosBlade-io/jvm-sandbox/pull/6")),(0,o.kt)("p",null,"\u90a3\u4e48\u5982\u4f55\u5f7b\u5e95\u89e3\u51b3Metaspace OOM\u95ee\u9898\u5462\uff1f\u5148\u8bf4\u7ed3\u8bba\uff1a\u4e0d\u80fd\u5f7b\u5e95\u89e3\u51b3\uff0c\u56e0\u4e3a\u5728\u4f7f\u7528\u53cd\u5c04\u7684\u60c5\u51b5\u4e0b\u4f1a\u81ea\u52a8\u751f\u6210\u4e00\u4e9b\uff08sun.reflect.DelegatingClassLoader\uff09\uff0c\u6240\u4ee5\u5728\u4e1a\u52a1\u4ee3\u7801\u4e2d\u5f88\u96be\u53bb\u5173\u95ed\uff0c\u90a3\u5c31\u5bfc\u81f4DelegatingClassLoader\u4f1a\u4e00\u76f4\u5b58\u6d3b\uff0c\u4ece\u800c\u5f15\u53d1Metaspace \u788e\u7247\u5316\u7684\u95ee\u9898\uff0c\u6700\u7ec8\u5bfc\u81f4Metaspace\u7a7a\u95f4\u65e0\u6cd5\u88ab\u6b63\u786e\u7684\u56de\u6536\uff08\u8fd9\u90e8\u5206\u5185\u5bb9\u6bd4\u8f83\u590d\u6742\uff0c\u4e00\u8a00\u4e24\u8bed\u5f88\u96be\u63cf\u8ff0\u6e05\u695a\uff09"),(0,o.kt)("a",{name:"grkSk"}),"## 5.5 \u601d\u8003 \u5173\u4e8eMetaspace OOM\u7684\u95ee\u9898\uff0c\u5176\u5b9e\u4f18\u5316\u662f\u4e00\u65b9\u9762\uff0c\u6362\u4e2a\u89d2\u5ea6\u60f3\u4e5f\u8bb8\u662f\u6211\u4eec\u4f7f\u7528\u7684\u65b9\u5f0f\u4e0d\u6b63\u786e\u3002\u5728\u6211\u4eec\u7684\u4e1a\u52a1\u573a\u666f\u4e0b\u662f\u4f1a\u9891\u7e41\u7684\u5bf9\u4e00\u4e2a\u670d\u52a1\u8fdb\u884c\u6545\u969c\u6ce8\u5165&\u5378\u8f7d\uff0c\u6bcf\u6b21\u7684\u6ce8\u5165\u70b9\u4e0d\u540c\u3002",(0,o.kt)("p",null,"\u5982\u4e0b\u56fe: \u76f8\u5f53\u4e8e\u6bcf\u6b21\u90fd\u662f\u91cd\u590d1-4\u6b65\u9aa4\uff0c\u90a3\u4e48\u5b9e\u9645\u4e0a\u6211\u4eec\u5e76\u4e0d\u9700\u8981\u8fd9\u4e48\u505a\uff0c\u56e0\u4e3a\u5728\u7b2c\u4e00\u6b65\u65f6sandbox\u521d\u59cb\u5316\u4f1a\u52a0\u8f7d\u5927\u91cf\u7684\u7c7b\uff0c\u586b\u5145metaspace\u3002\u800c\u6211\u4eec\u6bcf\u6b21\u6ce8\u5165\u53ea\u662f\u6545\u969c\u70b9\u4e0d\u540c,agent\u4e0d\u9700\u8981\u91cd\u65b0\u6302\u8f7d\uff0c\u6240\u4ee5\u53ea\u9700\u8981\u91cd\u590d\u7684\u8fdb\u884c\u7b2c2\u6b65\u548c\u7b2c\u4e09\u6b65\u5373\u53ef\u3002 \u5728\u7b2c2\u6b65\u548c\u7b2c3\u6b65\u4e2d\u53ea\u662f\u89e6\u53d1sandbox\u7684\u6fc0\u6d3b\u548c\u51bb\u7ed3\u4e8b\u4ef6\uff0c\u6210\u672c\u975e\u5e38\u5c0f\u3002"),(0,o.kt)("p",null,"\u540e\u9762\u6211\u4eec\u4f1a\u6839\u636e\u8fd9\u4e2a\u601d\u8def\uff0c\u5bf9\u6574\u4e2a\u6545\u969c\u6ce8\u5165\u6d41\u7a0b\u8fdb\u884c\u4f18\u5316\uff0c\u76f8\u4fe1\u4f1a\u6709\u66f4\u591a\u7684\u63d0\u5347\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{parentName:"p",src:"https://cdn.nlark.com/yuque/0/2022/png/215568/1662372406854-f575ffcf-01f9-4832-ae28-280d4b1848eb.png#clientId=u72ad57af-f46a-4&crop=0&crop=0&crop=1&crop=1&from=paste&height=371&id=ue01bb516&margin=%5Bobject%20Object%5D&name=image.png&originHeight=742&originWidth=1584&originalType=binary&ratio=1&rotation=0&showTitle=false&size=185312&status=done&style=none&taskId=ue7756adc-9d3d-40e1-a8d8-27adc8ff130&title=&width=792",alt:"image.png"})),(0,o.kt)("h1",{id:"6jit\u53ca\u65f6\u7f16\u8bd1\u5bfc\u81f4cpu\u6296\u52a8"},"6.JIT(\u53ca\u65f6\u7f16\u8bd1)\u5bfc\u81f4CPU\u6296\u52a8"),(0,o.kt)("h2",{id:"61-\u95ee\u9898\u63cf\u8ff0"},"6.1 \u95ee\u9898\u63cf\u8ff0"),(0,o.kt)("p",null,"\u5728Java\u4e2d\u7f16\u8bd1\u5668\u4e3b\u8981\u5206\u4e3a\u4e09\u7c7b\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u524d\u7aef\u7f16\u8bd1\u5668:JDK\u7684Javac\uff0c\u5373\u628a",(0,o.kt)("em",{parentName:"li"},".Java\u6587\u4ef6\u8f6c\u53d8\u6210"),".class\u6587\u4ef6\u7684\u8fc7\u7a0b"),(0,o.kt)("li",{parentName:"ol"},"\u5373\u65f6\u7f16\u8bd1\u5668:HotSpot\u865a\u62df\u673a\u7684C1,C2\u7f16\u8bd1\u5668,Graal\u7f16\u8bd1\u5668\uff0cJVM\u8fd0\u884c\u671f\u628a\u5b57\u8282\u7801\u8f6c\u53d8\u6210\u672c\u5730\u673a\u5668\u7801\u7684\u8fc7\u7a0b"),(0,o.kt)("li",{parentName:"ol"},"\u63d0\u524d\u7f16\u8bd1\u5668:JDK\u7684Jaotc,GNU Compiler for the Java(GCJ)\u7b49")),(0,o.kt)("p",null,"\u5728\u901a\u8fc7ChaosBlade\u8fdb\u884c\u6545\u969c\u6ce8\u5165\u540e\uff0c\u672c\u8d28\u662f\u5229\u7528jvm-sandbox\u5bf9\u76ee\u6807\u7c7b\u548c\u653e\u706b\u8fdb\u884c\u4e86\u5b57\u8282\u7801\u589e\u5f3a\u3002\u4ece\u800c\u4e5f\u4f1a\u89e6\u53d1JVM\u7684\u5373\u65f6\u7f16\u8bd1\uff08JIT-\tJust In Time\uff09"),(0,o.kt)("p",null,"JVM\u7684\u5373\u65f6\u7f16\u8bd1\u76ee\u7684\u662f\u8ba9\u5b57\u8282\u7801\u8f6c\u6362\u4e3a\u673a\u5668\u7801\uff0c\u4ece\u800c\u53ef\u4ee5\u66f4\u9ad8\u6548\u7684\u6267\u884c\u3002\u4f46\u662f\u5728JVM\u5373\u65f6\u7f16\u8bd1\u7684\u8fc7\u7a0b\u4e2d\u662f\u4f1a\u6d88\u8017\u8d44\u6e90\u7684\uff0c\u6700\u5178\u578b\u7684\u573a\u666f\u5c31\u662fJava\u7684\u670d\u52a1 \u5728\u521a\u542f\u52a8\u65f6CPU\u7684\u4f7f\u7528\u7387\u90fd\u4f1a\u76f8\u5bf9\u8f83\u9ad8\uff0c\u4e00\u6bb5\u65f6\u95f4\u540e\u9010\u6e10\u6062\u590d\u5e73\u7a33\uff0c\u51fa\u73b0\u8fd9\u79cd\u73b0\u8c61\u90e8\u5206\u60c5\u51b5\u4e0b\u662f\u56e0\u4e3a\u5373\u65f6\u7f16\u8bd1\u7684\u4ecb\u5165\u5bfc\u81f4\u7684\u3002\u5173\u4e8e\u5373\u65f6\u7f16\u8bd1\u7684\u5185\u5bb9\u53ef\u4ee5\u53c2\u8003",(0,o.kt)("a",{parentName:"p",href:"https://xie.infoq.cn/article/dacbe19251f8ec828efacdfde"},"\u6587\u7ae0")),(0,o.kt)("p",null,"\u5bf9\u4e8e\u5373\u65f6\u7f16\u8bd1\u5f15\u53d1\u7684CPU\u4f7f\u7528\u7387\u5347\u9ad8\u662f\u6b63\u5e38\u73b0\u8c61\uff0c\u5982\u679c\u9047\u5230JIT\u5360\u7528\u7684CPU \u4f7f\u7528\u7387\u7279\u522b\u9ad8\uff0c\u6211\u4eec\u9700\u8981\u7279\u6b8a\u5173\u6ce8\u4e0b\u5373\u65f6\u7f16\u8bd1\u7684\u53c2\u6570\u5373\u53ef\u3002\u4f8b\u5982\u662f\u5426\u542f\u7528\u4e86\u5206\u5c42\u7f16\u8bd1\uff0c\u7f16\u8bd1\u7684\u7ebf\u7a0b\u6570\u91cf\u7b49\u7b49\u3002"),(0,o.kt)("h1",{id:"7\u603b\u7ed3"},"7.\u603b\u7ed3"),(0,o.kt)("p",null,"ChaosBlade \u652f\u6301\u4e30\u5bcc\u7684\u6545\u969c\u6ce8\u5165\u573a\u666f\uff0c\u5c24\u5176\u662f\u5728Java \u751f\u6001\u4e2d\u652f\u6301\u5927\u91cf\u7684\u63d2\u4ef6\u3002\u5bf9\u4e8eJava \u573a\u666f\u7684\u6545\u969c\u6ce8\u5165\u4f18\u52bf\u6bd4\u8f83\u660e\u663e\u3002"),(0,o.kt)("p",null,"\u901a\u8fc7\u5bf9\u4e0a\u9762\u4ecb\u7ecd\u7684\u95ee\u9898\u8fdb\u884c\u4f18\u5316\uff0c\u4f7f\u7528ChaosBlade\u8fdb\u884cJava\u573a\u666f\u7684\u6545\u969c\u6ce8\u5165\u4e0d\u4f1a\u518d\u5bfc\u81f4CPU Idle\u8dcc\u5e95\uff0c\u5373\u4f7f\u5728\u7ebf\u4e0a\u8fd0\u884c\u7684\u670d\u52a1\u8fdb\u884c\u6545\u969c\u6ce8\u5165\u4e5f\u4f1a\u5c06CPU\u7684\u6296\u52a8\u63a7\u5236\u5728\u4e00\u4e2a\u8f83\u5c0f\u7684\u6ce2\u52a8\u8303\u56f4\u3002"),(0,o.kt)("p",null,"\u4f46\u7531\u4e8eJVM JIT\u7684\u95ee\u9898\u5728\u6545\u969c\u6ce8\u5165\u65f6CPU\u7684\u77ac\u65f6\u6296\u52a8\u8fd8\u662f\u65e0\u6cd5\u907f\u514d\uff0c\u5982\u679c\u5927\u5bb6\u6709\u4ec0\u4e48\u597d\u7684\u529e\u6cd5/\u60f3\u6cd5\u4e5f\u6b22\u8fce\u63d0\u4ea4issue/pr\u6765\u5171\u540c\u4ea4\u6d41\uff5e"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"ChaosBlade \u5b98\u65b9\u7f51\u5740\uff1a",(0,o.kt)("a",{parentName:"p",href:"https://chaosblade.io/"},"https://chaosblade.io/"),"\nChaosBlade Github : ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/chaosblade-io/chaosblade"},"https://github.com/chaosblade-io/chaosblade"),"\nChaosBlade \u9489\u9489\u793e\u533a\u4ea4\u6d41\u7fa4:23177705")))}d.isMDXComponent=!0}}]);