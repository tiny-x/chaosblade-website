<!doctype html>
<html lang="en" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.1.0">
<title data-rh="true">16 posts tagged with &quot;chaosblade&quot; | ChaosBlade</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" property="og:image" content="https://chaosblade.io/en/img/cb-logo.png"><meta data-rh="true" name="twitter:image" content="https://chaosblade.io/en/img/cb-logo.png"><meta data-rh="true" property="og:url" content="https://chaosblade.io/en/blog/tags/chaosblade"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="twitter:card" content="summary"><meta data-rh="true" property="og:title" content="16 posts tagged with &quot;chaosblade&quot; | ChaosBlade"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/en/img/favicon/favicon.ico"><link data-rh="true" rel="canonical" href="https://chaosblade.io/en/blog/tags/chaosblade"><link data-rh="true" rel="alternate" href="https://chaosblade.io/en/blog/tags/chaosblade" hreflang="en"><link data-rh="true" rel="alternate" href="https://chaosblade.io/blog/tags/chaosblade" hreflang="zh"><link data-rh="true" rel="alternate" href="https://chaosblade.io/blog/tags/chaosblade" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://AJZLJ48ZRO-dsn.algolia.net" crossorigin="anonymous"><link rel="alternate" type="application/rss+xml" href="/en/blog/rss.xml" title="ChaosBlade RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/en/blog/atom.xml" title="ChaosBlade Atom Feed">

<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-FY5W27B8XH"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-FY5W27B8XH",{anonymize_ip:!0})</script>


<link rel="search" type="application/opensearchdescription+xml" title="ChaosBlade" href="/en/opensearch.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;600&display=block">
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@400;600&display=block">
<script src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/en/assets/css/styles.ed732878.css">
<link rel="preload" href="/en/assets/js/runtime~main.0f7f60ef.js" as="script">
<link rel="preload" href="/en/assets/js/main.a201f323.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();null!==e?t(e):window.matchMedia("(prefers-color-scheme: dark)").matches?t("dark"):(window.matchMedia("(prefers-color-scheme: light)").matches,t("light"))}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div role="region" aria-label="theme.common.skipToMainContent"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><div class="announcementBar_mb4j" role="banner"><div class="announcementBarPlaceholder_vyr4"></div><div class="content_knG7 announcementBarContent_xLdY">⭐️  &nbsp; If you like ChaosBlade, give it a star on <a target="_blank" rel="noopener noreferrer" href="https://github.com/chaosblade-io/chaosblade">GitHub</a>! ⭐️</div><button type="button" aria-label="Close" class="clean-btn close closeButton_CVFx announcementBarClose_gvF7"><svg viewBox="0 0 15 15" width="14" height="14"><g stroke="currentColor" stroke-width="3.1"><path d="M.75.75l13.5 13.5M14.25.75L.75 14.25"></path></g></svg></button></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/en/"><div class="navbar__logo"><img src="/en/img/cb-head.png" alt="ChaosBlade" class="themedImage_ToTc themedImage--light_HNdA"><img src="/en/img/cb-head.png" alt="ChaosBlade" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ChaosBlade</b></a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/en/docs/">1.7.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/en/docs/next/">Next</a></li><li><a class="dropdown__link" href="/en/docs/">1.7.0</a></li></ul></div><a class="navbar__item navbar__link" href="/en/docs">Documentation</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/en/blog">Blog</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/chaosblade-io/chaosblade" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-githab-link"></a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link"><svg viewBox="0 0 24 24" width="20" height="20" aria-hidden="true" class="iconLanguage_nlXk"><path fill="currentColor" d="M12.87 15.07l-2.54-2.51.03-.03c1.74-1.94 2.98-4.17 3.71-6.53H17V4h-7V2H8v2H1v1.99h11.17C11.5 7.92 10.44 9.75 9 11.35 8.07 10.32 7.3 9.19 6.69 8h-2c.73 1.63 1.73 3.17 2.98 4.56l-5.09 5.02L4 19l5-5 3.11 3.11.76-2.04zM18.5 10h-2L12 22h2l1.12-3h4.75L21 22h2l-4.5-12zm-2.62 7l1.62-4.33L19.12 17h-3.24z"></path></svg>English</a><ul class="dropdown__menu"><li><a href="/en/blog/tags/chaosblade" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" lang="en">English</a></li><li><a href="/blog/tags/chaosblade" target="_self" rel="noopener noreferrer" class="dropdown__link" lang="zh">简体中文</a></li></ul></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_pO2u margin-bottom--md">全部博文</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2022/11/01/chaosblade-operator">大规模 Kubernetes 集群故障注入的利器-ChaosBlade</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2022/09/09/chaosblade-java">ChaosBlade Java 场景性能优化，那些你不知道的事</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released-ch">ChaosBlade-Box全新混沌工程平台 -- 助力企业混沌工程落地</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released">ChaosBlade-Box, a New Version of the Chaos Engineering Platform Has Released</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2022/06/24/ChaosBlade-Box-new-release">混沌工程平台 ChaosBlade-Box 新版重磅发布</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2022/03/03/ChaosBlade-From-the-Chaos-Engineering-Experiment-Tool-to-the-Chaos-Engineering-Platform">ChaosBlade, From the Chaos Engineering Experiment Tool to the Chaos Engineering Platform</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2021/12/08/chaos-engineering-value">被你质疑价值的混沌工程，阿里巴巴已落地实践了9年</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2021/06/06/summer-2021">暑期2021</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2021/05/21/chaos-engineering">混沌工程介绍与实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2020/08/06/chaosblade-start-5">ChaosBlade：从零开始的混沌工程（五）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2020/07/22/chaosblade-start-4">ChaosBlade：从零开始的混沌工程（四）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2020/06/15/chaosblade-start-3">ChaosBlade：从零开始的混沌工程（三）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2020/06/09/chaosblade-start-2">ChaosBlade：从零开始的混沌工程（二）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2020/06/04/chaosblade-start-1">ChaosBlade：从零开始的混沌工程（一）</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2019/10/17/chaosblade-cloud-native">ChaosBlade：云原生架构下的混沌工程探索和实践</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/en/blog/2019/07/03/chaosblade-chaos-engineering-tools">Chaosblade, 阿里一个超级牛逼的混沌实验实施工具</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>16 posts tagged with &quot;chaosblade&quot;</h1><a href="/en/blog/tags">View All Tags</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2022/11/01/chaosblade-operator">大规模 Kubernetes 集群故障注入的利器-ChaosBlade</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-11-01T00:00:00.000Z" itemprop="datePublished">November 1, 2022</time> · <!-- -->31 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tiny-x" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/29175949?v=4" alt="叶飞（@tiny-x）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tiny-x" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">叶飞（@tiny-x）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade">ChaosBlade<a class="hash-link" href="#chaosblade" title="Direct link to heading">​</a></h2><p>随着云原生的发展，云原生应用一致性、可靠性、灵活编排的能力让大部分企业选择将应用往云上迁移，但同时云基础设施在稳定性、高可用、可观测方面也接受着强大的考验。
ChaosBlade 是阿里巴巴开源的一款遵循混沌工程原理和混沌实验模型的实验注入工具，帮助企业提升分布式系统的容错能力，并且在企业上云或往云原生系统迁移过程中业务连续性保障。
ChaosBlade Operator 是 kubernetes 平台实验场景的实现，将混沌实验通过 Kubernetes 标准的 CRD 方式定义，很方便的使用 Kubernetes 资源操作的方式来创建、更新、删除实验场景，包括使用 kubectl、client-go 等方式执行，同时也可以使用 chaosblade cli 工具执行。
<strong>本文将主要介绍 ChaosBlade 在 Kubernetes 中故障注入的底层实现原理、版本优化过程以及大规模应用演练测试。</strong></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="资源模型">资源模型<a class="hash-link" href="#资源模型" title="Direct link to heading">​</a></h3><p>在 Kubernetes 中部署应用，通常我们会选择将应用定义为 pod、Deployment、Statefulset 等资源类型，这些都是 Kubernetes 已经内置的；在实际应用中，面对对复杂的应用场景，内置的资源类型是无法满足我们需求的，Operator 是一种解决复杂应用容器化的一种方案，通过自定义资源和自定义控制器来实现复杂应用容器化，chaosblade-operator 正是就是基于 Operator 实现的。
在 Kubernetes 中安装完 chaosblade-operator 后，会生成一个 deployment 资源类型的  chaosblade-operator 实例、一个 daemonset 资源类型的  chaosblade-tool 实例、一个自定义资源定义，当然还包含 RABC、SA 等等其他资源；
<img loading="lazy" alt="image.png" src="/en/assets/images/1-5811aae76c5b797fd9aa00b4bf7ea38c.png" width="1016" height="288" class="img_ev3q">
chaosblade 将自定义资源类型定义为  chaosblade ，简称 blade ；每次新建演练就可以通过 kubectl 或者 chaosblade cli 创建 blade 实例资源，blade 资源本身也包含了 chaosblade 混沌实验定义；
chaosblade-operator 会监听 blade 资源的生命周期，当发现有 blade 资源实例被创建时，同时就能拿到混沌实验定义，然后解析实验定义，去调用 chaosblade-tool 真正的注入故障；
chaosblade-tool 是 daemonset 资源类型，一个 Node 节点必定会部署一个 pod，从 Linux Namespace 的维度出发，该 pod 网络、PID 命名空间与 Node 节点处在同一命名空间，因此可以做到部分 Node 级别的演练。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="生命周期">生命周期<a class="hash-link" href="#生命周期" title="Direct link to heading">​</a></h3><p>在资源模型中，简单提到了 chaosblade-operator 会监听 blade 资源的创建； chaosblade-operator 实则会监听整个 blade 资源的生命周期，blade 资源的生命周期等同演练实验生命周期；chaosblade-operator 会根据 blade 资源状态去更新实验的状态</p><table><thead><tr><th>blade 资源状态</th><th>实验过程</th><th>CPU 负载案例</th></tr></thead><tbody><tr><td>apply(新建)</td><td>新建演练</td><td>新建 CPU 负载演练</td></tr><tr><td>running(运行中)</td><td>演练运行中</td><td>CPU 负载中</td></tr><tr><td>deleted(被删除)</td><td>恢复演练</td><td>恢复演练</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="故障注入">故障注入<a class="hash-link" href="#故障注入" title="Direct link to heading">​</a></h3><p>在资源模型中提到了 chaosblade-operator 发现有 blade 资源实例被创建时，同时就能拿到混沌实验定义，然后解析实验定义，去真正的注入故障；那么 chaosblade-operator 是如去真正的注入故障呢？
其实在早期的 chaosblade-operator 版本中，大部分场景是通过将 chaosblade cli 工具通过 kubenetes API 通道复制到容器内部，然后再去容器内部执行命令来实现故障注入，整体实现方案入下图；
<img loading="lazy" alt="1.5.x.png" src="/en/assets/images/2-6bd084864fa50265ab0c4d01ffcb4228.png" width="992" height="414" class="img_ev3q">
可以看到左边的 yaml 定义就是 Chaosblade 混沌实验模型定义，也是 blade 资源实例的一部分信息，当 blade 资源通过 kubectl apply 以后，chaosblade-operator 会监听到资源的创建，同时解析到实验定义；
当解析道 scope = node 的时候，会找到 node 节点所在 chaosblade-tool pod 中执行命令，这些动作几乎对整个集群来说资源消耗也是极少的；
但是当解析道 scope = pod 或者  scope = container  的时候，大部分场景 chaosblade-operator 会把 chaosblade cli 工具本身复制到业务容器内部，然后再去业务容器执行命令，工具包的大小、实验选择的容器数量、决定了资源的消耗大小，往往兼容性、版本更新等等都得不到很好的保障；
<strong>在新版本的 chaosblade-operator 版本中，将在下面最初的问题、优化过程、实现原理等小节详细介绍。</strong></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="最初的痛点">最初的痛点<a class="hash-link" href="#最初的痛点" title="Direct link to heading">​</a></h2><p>当一个云原生应用达到一定规模时，去进行演练；</p><ul><li>集群环境：1000 个 node 节点</li><li>目标应用：deployment 有 5000 个副本数</li><li>演练场景：对该应用对外提供的接口返回延迟 1000 毫秒</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="注入慢">注入慢<a class="hash-link" href="#注入慢" title="Direct link to heading">​</a></h3><p>首先需要找到 5000 个副本，将工具复制到容器，在进入容器执行命令，假设一个复制工具耗费 100 毫秒，那么整个过程耗费时间 500000 毫秒，这对用户来说简直是不可接受的。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="网络带宽占用">网络带宽占用<a class="hash-link" href="#网络带宽占用" title="Direct link to heading">​</a></h3><p>将工具复制到容器，至少需要调用 kubernetes api 5000次，假设一个可执文件大小 5MB , 5000 次需要占用总带宽流量 5000x5=25000MB ，对 IO 影响简直就是灾难级别的；</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="兼容性问题">兼容性问题<a class="hash-link" href="#兼容性问题" title="Direct link to heading">​</a></h3><p>假设我们已经通过层层考验，已经工具将工具复制进去，当工具本身依赖了依赖一些命令，比如网络（tc）、磁盘（dd）等容器中又没有这些命令，或者版本不兼容该如何处理？</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="只读-pod">只读 pod<a class="hash-link" href="#只读-pod" title="Direct link to heading">​</a></h3><p>对于配置了只读文件系统的 pod，文件是不可写入的，因此压根就没发将工具复制进去</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="侵入型">侵入型<a class="hash-link" href="#侵入型" title="Direct link to heading">​</a></h3><p>将工具留在业务容器内部，等同于将工具生命周期与容器绑定在一起；</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="优化过程">优化过程<a class="hash-link" href="#优化过程" title="Direct link to heading">​</a></h2><p>在最初版本的迭代过程我们做过很多优化，同步转异步、包瘦身、按需复制等等优化方案，虽然一定程度上提高了注入的效率，但是没有解决问题的本质，还是受限于主机的 IO 性能；
无论是同步转异步、包瘦身、按需复制等优化方案，本质没法解决工具复制带来的一些问题；羊毛出在羊身上，解决问题就得解决问题的本质，从 Linux 虚拟化技术的角度思考，如何不复制工具就在能容器中注入故障呢？</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="linux-虚拟化">Linux 虚拟化<a class="hash-link" href="#linux-虚拟化" title="Direct link to heading">​</a></h3><p>对于 Linux 虚拟化技术而言，核心实现原理就是 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力，以及基于 rootfs 的文件系统；
Linux Namespace 可以让进程（容器）处在一个独立的沙箱环境，Linux Cgroups 可以限制该沙箱内进程的资源使用，比如限制 CPU、内存的使用率等等；</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-cgroups">Linux Cgroups<a class="hash-link" href="#linux-cgroups" title="Direct link to heading">​</a></h4><p>Linux Cgroups  可以限制沙箱内进程的资源使用，并且也可以人为将某个进程的资源使用交给已经存在的某个的 Linux Cgroups 控制，而通常容器的资源使用率统计也是 Linux Cgroups 控制组下面进程的使用情况计算出来的；此时在宿主机启动的一个 CPU 负载的进程，并且将该进程交给某个已经存在的容器的控制组控制，就相当于给该容器注入了 CPU 负载场景。
在  docker 上面尝试在不侵入该容器的情况下，给容器 nginx 注入 CPU 负载的场景。首先启动一个 nginx 容器 <code>docker run -it -d -p 8087:80 --cpus 0 --name nginx nginx</code>，容器启动后 docker 会给该容器新建一个 Cgroups  控制组，在该命令中会限制该容器只能使用一个核心的 CPU 。</p><ol><li>找到容器的进程 PID，该进程是容器启动时第一个进程</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> inspect --format </span><span class="token string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>查看进程的 Cgroups 控制组，可以看到有 CPU、内存、blkio 等等很多 Cgroup 子系统</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /proc/</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">docker</span><span class="token variable" style="color:#36acaa"> inspect --format </span><span class="token variable string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token variable" style="color:#36acaa"> nginx</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/cgroup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">11</span><span class="token plain">:devices:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">10</span><span class="token plain">:blkio:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">9</span><span class="token plain">:pids:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">8</span><span class="token plain">:memory:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7</span><span class="token plain">:freezer:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">6</span><span class="token plain">:perf_event:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">5</span><span class="token plain">:cpuset:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">4</span><span class="token plain">:hugetlb:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">3</span><span class="token plain">:cpuacct,cpu:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">2</span><span class="token plain">:net_prio,net_cls:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">:name</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">systemd:/docker/4bcf3de8de2904b3308d8fc8dbdf6155cad7763fa108a32e538402156b6eacaa</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>查看 CPU 控制组进程列表，可以有很多进程受该容器 Cgroup CPU 子系统控制；按照这个思路，我们只需要启动一个 CPU 负载进程，并且将进程 PID 写入这个文件，就可以做到容器 CPU 注入；</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> /sys/fs/cgroup/cpu</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">cat</span><span class="token variable" style="color:#36acaa"> /proc/</span><span class="token variable punctuation" style="color:#393A34">$(</span><span class="token variable" style="color:#36acaa">docker inspect --format </span><span class="token variable string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token variable" style="color:#36acaa"> nginx</span><span class="token variable punctuation" style="color:#393A34">)</span><span class="token variable" style="color:#36acaa">/cgroup </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&#x27;:&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $3}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/tas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ks</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7921</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7980</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7981</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7982</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">7983</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>CPU 负载脚本</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token shebang important">#! /bin/bash</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">while</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">do</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token builtin class-name">echo</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;&quot;</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> /dev/null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">done</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>执行 CPU 负载脚本后找到 PID ，将进程写入容器进程列表文件</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">echo</span><span class="token plain"> PID </span><span class="token operator" style="color:#393A34">&gt;&gt;</span><span class="token plain"> /sys/fs/cgroup/cpu</span><span class="token variable" style="color:#36acaa">$(</span><span class="token variable function" style="color:#d73a49">cat</span><span class="token variable" style="color:#36acaa"> /proc/</span><span class="token variable punctuation" style="color:#393A34">$(</span><span class="token variable" style="color:#36acaa">docker inspect --format </span><span class="token variable string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token variable" style="color:#36acaa"> nginx</span><span class="token variable punctuation" style="color:#393A34">)</span><span class="token variable" style="color:#36acaa">/cgroup </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">head</span><span class="token variable" style="color:#36acaa"> -n </span><span class="token variable number" style="color:#36acaa">1</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable operator" style="color:#393A34">|</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable function" style="color:#d73a49">awk</span><span class="token variable" style="color:#36acaa"> -F </span><span class="token variable string" style="color:#e3116c">&#x27;:&#x27;</span><span class="token variable" style="color:#36acaa"> </span><span class="token variable string" style="color:#e3116c">&#x27;{print $3}&#x27;</span><span class="token variable" style="color:#36acaa">)</span><span class="token plain">/tas</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ks</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="5"><li>此时可以观察到容器 CPU 达到 100%，而宿主机未达到，说明 CPU 负载只对容器产生了效果，运用同样的方式，可以做到资源占用形的任何故障场景，比如内存、IO 等</li></ol><p>最终成功在不侵入该容器的情况下，给该容器注入 CPU 负载的场景。通过 Cgroups 控制组，还能做到其他 Cgroups 支持的子系统的场景注入，比如 CPU 高负载、内存占用高、IO 高负载等等；</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="linux-namespace">Linux Namespace<a class="hash-link" href="#linux-namespace" title="Direct link to heading">​</a></h4><p>通过 Linux Cgroups 做到了不侵入该容器的情况下，给该容器注入 CPU 负载的场景，同时也能支持 CPU 高负载、内存占用高、IO 高负载等等； 对于其他类型的故障，比如网络延时、文件删除等等，则需要通过另外一种方式来实现 ， 就是 Linux Namespace 的隔离能力。
Linux Namespace 提供了网络、IPC、MNT 等命名空间隔离的能力，在容器独立的 Namespace 下，新建一个文件，新启动一个进程等等操作也是其他容器不可感知和观测到的；
在  docker 上面尝试在不侵入该容器的情况下，给 nginx 容器注入网络延时的场景。首先启动一个 nginx 容器 <code>docker run -it -d -p 8087:80 --cpus 0 --name nginx nginx</code>，在宿主机开放端口 8080 代理到容器内 80  端口， 容器启动后会有独立的网络命名空间，监听 80 端口。</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="宿主机网络延时">宿主机网络延时<a class="hash-link" href="#宿主机网络延时" title="Direct link to heading">​</a></h5><p>TC (TrafficControl) 用于Linux内核的流量控制，可以做到网络延时、丢包等等，先尝试利用 TC 在宿主机上注入网络延时，比如需要注入一个网络延时 100ms 的场景，在宿主机上执行如下命令</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#延时</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tc qdisc </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> dev eth0 root netem delay 100ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时在客户端打开浏览器访问 <code>http://IP:8087</code> 会查看到有稳定 100ms 的延时，而仔细观测后会发现其他端口也会有延时，比如 22、3306 等等；（注意，只能在别的客户端机器访问，不能在直接在当前机器通过 <code>curl http://127.0.0.1:8087</code> 验证）</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">#   恢复</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">tc qdisc del dev eth0 root</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="容器内网络延时">容器内网络延时<a class="hash-link" href="#容器内网络延时" title="Direct link to heading">​</a></h5><p>如何在容器中注入一个网络延时呢？其实非常简单，Linux 提供了 setns() 函数，可以方便进入指定进程所在命名空间；如果注入网络延时，只需要进入目标容器的网络命名空间即可；</p><ol><li>找到容器的进程</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> inspect --format </span><span class="token string" style="color:#e3116c">&quot;{{.State.Pid}}&quot;</span><span class="token plain"> nginx</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="2"><li>进入容器所在命名空间，nsenter 命令最终会调用 setns() 函数，如果没有此命令，需要安装 util-linux 包</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nsenter -t </span><span class="token number" style="color:#36acaa">7921</span><span class="token plain"> -n</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="3"><li>此时查看 IP 相关信息，返回的则是容器内 IP 相关信息</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ </span><span class="token function" style="color:#d73a49">ip</span><span class="token plain"> addr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">1</span><span class="token plain">: lo: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">LOOPBACK,UP,LOWER_UP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mtu </span><span class="token number" style="color:#36acaa">65536</span><span class="token plain"> qdisc noqueue state UNKNOWN group default qlen </span><span class="token number" style="color:#36acaa">1000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inet </span><span class="token number" style="color:#36acaa">127.0</span><span class="token plain">.0.1/8 scope </span><span class="token function" style="color:#d73a49">host</span><span class="token plain"> lo</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       valid_lft forever preferred_lft forever</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token number" style="color:#36acaa">124</span><span class="token plain">: eth0@if125: </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain">BROADCAST,MULTICAST,UP,LOWER_UP</span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> mtu </span><span class="token number" style="color:#36acaa">1500</span><span class="token plain"> qdisc noqueue state UP group default</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    link/ether 02:42:ac:11:00:13 brd ff:ff:ff:ff:ff:ff link-netnsid </span><span class="token number" style="color:#36acaa">0</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    inet </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.0.19/16 brd </span><span class="token number" style="color:#36acaa">172.17</span><span class="token plain">.255.255 scope global eth0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">       valid_lft forever preferred_lft forever</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><ol start="4"><li>注入网络延时也只会对容器生效</li></ol><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">tc qdisc </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> dev eth0 root netem delay 100ms</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>此时在客户端打开浏览器访问 <code>http://IP:8087</code> 会查看到有稳定 100ms 的延时，但是并不会对其他端口生效，比如 22、3306 等等；因为实际延时本身是作用在容器网络命名空间内，并且不会对宿主机生效。
最终成功在不侵入该容器的情况下，给该容器注入网络延时的故障场景。LInux 提供了很多维度的命名空间隔离，并且允许加入任何类型的命名空间，通过 Linux Namespace ，还能做到文件删除、杀进程等等场景</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-实现">chaosblade 实现<a class="hash-link" href="#chaosblade-实现" title="Direct link to heading">​</a></h3><p>在  Chaosblade 1.6.x 版本已经通过 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力实现容器化故障注入，chaosblade-operator 主要负责监听 crd 资源状态变更，chaosblade-operator  不在去执行故障注入的操作，而且由作为 dasemonset 类型资源 chaosblade-tool 主要负责真正的注入故障，整体实现方案入下图：</p><p><img loading="lazy" alt="image.png" src="/en/assets/images/3-a5a780fa828d87619d32dc328938f917.png" width="1598" height="896" class="img_ev3q"></p><p>同理可以看到左边的 yaml 定义就是 Chaosblade 混沌实验模型定义，也是 blade 资源实例的一部分信息，当 blade 资源通过 kubectl apply 以后，chaosblade-operator 会监听到资源的创建，同时解析到实验定义；
当解析到 scope = node 的时候，会找到 node 节点所在 chaosblade-tool pod 中执行命令，这些动作几乎对整个集群来说资源消耗也是极少的，这部分和早期版本几乎是没有任何区别的；
但是当解析道 scope = pod 或者  scope = container  的时候， chaosblade-operator 并不会把 chaosblade cli 工具本身复制到业务容器内部，更不会去容器里面执行相关命令，极大的减少了对 kubernetes API 的依赖；那么 chaosblade-operator 究竟是怎么做的呢？ chaosblade-operator 仅仅通过 kubernetes API  找到实验对象，即目标业务 pod，然后继续找到目标业务 pod 所在的节点上部署的 chaosblade-tool pod ，解析 pod 里面的容器名称，最后封装命令直接在 chaosblade-tool 执行命令，去真正的执行故障注入；在 chaosblade-tool 层注入故障的时候已经没有 pod 的概念，这一层是  chaosblade-operator 去解析和封装的；
为何在目标业务 pod 所在的节点上部署的 chaosblade-tool 执行命令，能够直接对目标业务 pod 生效呢？如果你仔细阅读了之前 <strong>Linux 虚拟化 </strong>章节，相信你已经有了答案；chaosblade-tool 作为 daemonset 资源，拥有宿主机 PID 命令空间切换的能力，同时在资源定义时也已经宿主机将 <code>/sys/fs</code> 目录挂载进 chaosblade-tool  pod，使得 chaosblade-tool  能够自由更该进程的 cgroups 控制组；所以 chaosblade-tool 可以对该宿主机上任意容器注入故障，将 chaosblade-operator  的一部分工作剥离了出来，使用 chaosblade-operator  的职责更简单一且轻量级，符合最初的设计理论；
Chaosblade-tool  通过 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力实现容器化故障注入，不论是性能、兼容性、稳定性都有极大的提升；因为大部分场景是可以直接 chaosblade-tool 执行的，只要保证  chaosblade-tool  容器依赖库版本和命令能够支持演练，就不会存在兼容性、稳定性等问题；就好比在早起的版本中，我们甚至需要考虑目标业务容器中没有 dd、tc 命令怎么，或者 dd 版本命令不兼容又怎么办等等问题。
无论 kubernetes 使用 docker、contained、crio 或者其他容器运行时相关技术，Chaosblade 都能做到快速兼容，因为 Chaosblade 通过 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力实现容器化故障注入，对容器运行时相关的 API 依赖并不大，只需要找到容器 1 号进程即可；</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="场景分析">场景分析<a class="hash-link" href="#场景分析" title="Direct link to heading">​</a></h4><p>首先先从 chaosblade 支持的故障场景出发，基于进程维度故障注入的方式可以分为两类<strong>资源占用和状态变更；</strong>
<strong>资源占用 </strong>注入的方式很容易理解，通过运行可持续占用资源的进程，并且保证进程的持续运行，来达到占用系统资源的目的，通过有 CPU 满载、内存满载、磁盘IO负载、端口占用 等；
<strong>状态变更 </strong>注入的方式可能不是那么贴切，此“状态”可以理解为磁盘可用大小、文件权限、pod 状态等等，实现这种类型的故障注入，我们需要通过运行一个进程来打包修该目标资源的状态即可，当然【状态变更】的方式也有可能进程需要运行很长时间来完成，与【资源占用】不同的时，他是需要一个终态来完成故障的注入，即进程执行成功，而不是需要保证进程的持续运行。
将 chaosblade 支持的故障场景分类，得下如下表格：</p><table><thead><tr><th>场景</th><th></th><th>是否加入 Cgroup 控制</th><th>需要进入的命名空间</th></tr></thead><tbody><tr><td>CPU</td><td><strong>资源占用</strong></td><td>是</td><td>PID</td></tr><tr><td>内存</td><td><strong>资源占用</strong></td><td>是</td><td>PID</td></tr><tr><td>磁盘IO</td><td><strong>资源占用</strong></td><td>是</td><td>PID</td></tr><tr><td>磁盘容量</td><td>状态变更</td><td>否</td><td>MNT</td></tr><tr><td>杀进程</td><td>状态变更</td><td>否</td><td>PID</td></tr><tr><td>网络延时、丢包、乱序（主要 tc 实现的场景）</td><td>状态变更</td><td>否</td><td>NET</td></tr><tr><td>网络端口占用</td><td><strong>资源占用</strong></td><td>否</td><td>NET</td></tr><tr><td>文件场景</td><td>状态变更</td><td>否</td><td>MNT</td></tr></tbody></table><p>在资源占用的故障注入模式下，需要判断资源是否是宿主机级别共享的，并且是 Linux Cgroups 已经支持的子系统，比如 CPU、内存、磁盘IO 等等，只需要进入目标容器进程的 PID 命令空间，然后加入目标容器进程控制组即实现故障注入；也有比较特别的，比如网络端口占用，虽然它被列为属于资源占用的故障注入模式，但是端口是独立命名空间内共享的资源，所以他是需要通过 NET 命名空间切换才能实现的。
在状态变更的故障注入模式下，通过需要根据具体场景，进入目标容器进程的命令空间去做一些操作，比如网络场景，需要进入 NET Namespace；文件场景需要进入 MNT Namespace 等等。
在 chaosblade-1.6.x 版本下，也已经提供命名空间切换的实现，比如进入容器（进程 PID 是 35941）命名空间执行 ls 命令：
<img loading="lazy" alt="image.png" src="/en/assets/images/4-d85ea98715efd589f738503d2279c319.png" width="2224" height="798" class="img_ev3q">
结合场景的注入模式以及 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力，大都是情况下都能分析出场景应该通过什么样的方式在容器注入故障；</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="大规模应用演练">大规模应用演练<a class="hash-link" href="#大规模应用演练" title="Direct link to heading">​</a></h2><p>在 Chaosblade 1.6.x 版本已经通过 Linux Namespace 的隔离能力、Linux Cgroups 的限制能力实现容器化故障注入，相比通过工具复制的方式，效率提升显著、兼容性更强、而且无侵入。
在此章节通过实际场景来观测 chaosblade-operator 早期版本和 Chaosblade chaosblade-operator 1.6.x 版本的注入性能和资源消耗情况。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实验案例">实验案例<a class="hash-link" href="#实验案例" title="Direct link to heading">​</a></h3><p>分别在 kubernetes 部署  chaosblade-operator 1.5.0 版本和 chaosblade-operator 1.6.1版本，分三次实验，注入 CPU load 场景来观察注入性能、磁盘IO、网络带宽；</p><ul><li>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 20</li><li>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 50</li><li>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 100</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实验环境">实验环境<a class="hash-link" href="#实验环境" title="Direct link to heading">​</a></h3><p>三节点 kubernetes 集群，master 为可调度模式</p><table><thead><tr><th>节点/资源</th><th>CPU</th><th>内存</th></tr></thead><tbody><tr><td>master1</td><td>4c</td><td>16g</td></tr><tr><td>node1</td><td>4c</td><td>16g</td></tr><tr><td>node2</td><td>4c</td><td>16g</td></tr></tbody></table><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实验结果">实验结果<a class="hash-link" href="#实验结果" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-operator-150-版本">chaosblade-operator 1.5.0 版本<a class="hash-link" href="#chaosblade-operator-150-版本" title="Direct link to heading">​</a></h4><p>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 20；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时">注入耗时<a class="hash-link" href="#注入耗时" title="Direct link to heading">​</a></h5><p>注入耗时达到 57s</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;4fce727793e239cb&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    0m57.851s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m0.811s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.208s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗">资源消耗<a class="hash-link" href="#资源消耗" title="Direct link to heading">​</a></h5><p>可以看到网络带宽接受峰值达到 180MBs 左右，传输峰值达到 140MBs 左右
<img loading="lazy" alt="image.png" src="/en/assets/images/5-73c1e7fa7c7734505c61b39785cd2f2a.png" width="2878" height="1100" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/en/assets/images/6-dfccf17439578511027db01c61836713.png" width="2728" height="1266" class="img_ev3q">
在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 50；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-1">注入耗时<a class="hash-link" href="#注入耗时-1" title="Direct link to heading">​</a></h5><p>注入耗时达到 2m25.806s</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;71e07348af26e4aa&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    2m25.806s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m1.010s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.239s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-1">资源消耗<a class="hash-link" href="#资源消耗-1" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/en/assets/images/7-56580e3e243b866e01602dd9fc204bf9.png" width="2868" height="1086" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/en/assets/images/8-ca6e6ac5710aaa33e2b75191fe398f15.png" width="2738" height="1272" class="img_ev3q">
在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 100；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，为了避免出现超时情况，不太好评估注入耗时，所有此时将等待时间设置为 20 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-2">注入耗时<a class="hash-link" href="#注入耗时-2" title="Direct link to heading">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 20m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;cc477f2c632e2510&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    4m59.776s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m1.132s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.281s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-2">资源消耗<a class="hash-link" href="#资源消耗-2" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/en/assets/images/9-5831d2342c96c8ffc70931a885393712.png" width="3830" height="1612" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/en/assets/images/10-8b9bbfd378ec1b2dd6e0936fc470ecc4.png" width="3692" height="1220" class="img_ev3q"></p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-operator-161-版本">chaosblade-operator 1.6.1 版本<a class="hash-link" href="#chaosblade-operator-161-版本" title="Direct link to heading">​</a></h4><p>这次安装 chaosblade-operator 1.6.1 版本</p><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"> helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> chaosblade-operator chaosblade-operator-1.5.0.tgz</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 20；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-3">注入耗时<a class="hash-link" href="#注入耗时-3" title="Direct link to heading">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;fe8ebc493bda3d7e&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    0m5.537s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m0.525s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.067s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-3">资源消耗<a class="hash-link" href="#资源消耗-3" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/en/assets/images/11-acb28dd2fb74cfca2be30961563a5c30.png" width="3824" height="1632" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/en/assets/images/12-c7dd073f8ea6c37100545f1515dae0bd.png" width="3700" height="1216" class="img_ev3q">
在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 50；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-4">注入耗时<a class="hash-link" href="#注入耗时-4" title="Direct link to heading">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;a4d9c4c9c16642b5&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    0m24.519s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m0.597s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.071s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-4">资源消耗<a class="hash-link" href="#资源消耗-4" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/en/assets/images/13-82cf8300512f1c9e719fcab53d748d66.png" width="3826" height="1598" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/en/assets/images/14-17f844bce6986f748841db12565074cd.png" width="3700" height="1230" class="img_ev3q">
在 kubernetes 中部署 tomcat deployment 资源类型，副本数设置为 100；通过 chaosblade cli 注入 CPU load 场景，指定 CPU 使用率为 60，通过标签来筛选出所有 pod，设置等待时间为 5 分钟；</p><h5 class="anchor anchorWithStickyNavbar_LWe7" id="注入耗时-5">注入耗时<a class="hash-link" href="#注入耗时-5" title="Direct link to heading">​</a></h5><div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">time</span><span class="token plain"> ./blade create k8s pod-cpu load --kubeconfig ~/.kube/config --namespace default --cpu-percent </span><span class="token number" style="color:#36acaa">60</span><span class="token plain"> --labels </span><span class="token assign-left variable" style="color:#36acaa">app</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">tomcat --waiting-time 5m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">{</span><span class="token string" style="color:#e3116c">&quot;code&quot;</span><span class="token plain">:200,</span><span class="token string" style="color:#e3116c">&quot;success&quot;</span><span class="token plain">:true,</span><span class="token string" style="color:#e3116c">&quot;result&quot;</span><span class="token builtin class-name">:</span><span class="token string" style="color:#e3116c">&quot;f4f4790a369cc448&quot;</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">real    1m46.554s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">user    0m0.696s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sys 0m0.055s</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h5 class="anchor anchorWithStickyNavbar_LWe7" id="资源消耗-5">资源消耗<a class="hash-link" href="#资源消耗-5" title="Direct link to heading">​</a></h5><p><img loading="lazy" alt="image.png" src="/en/assets/images/15-cd4c24a0cdb213035d922e9808121fe9.png" width="3820" height="1614" class="img_ev3q">
<img loading="lazy" alt="image.png" src="/en/assets/images/16-7b1f68702002df9f565b1f4b0c603632.png" width="3692" height="1228" class="img_ev3q"></p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="实验总结">实验总结<a class="hash-link" href="#实验总结" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-operator-150-版本-1">chaosblade-operator 1.5.0 版本<a class="hash-link" href="#chaosblade-operator-150-版本-1" title="Direct link to heading">​</a></h4><table><thead><tr><th>pod 数量/影响范围</th><th>注入耗时</th><th>磁盘IO影响</th><th>网络带宽影响</th></tr></thead><tbody><tr><td>20</td><td>57s</td><td>略微影响</td><td>影响大</td></tr><tr><td>50</td><td>2m25s</td><td>影响大</td><td>影响大</td></tr><tr><td>100</td><td>4m59s</td><td>影响极大</td><td>影响极大</td></tr></tbody></table><h4 class="anchor anchorWithStickyNavbar_LWe7" id="chaosblade-operator-161-版本-1">chaosblade-operator 1.6.1 版本<a class="hash-link" href="#chaosblade-operator-161-版本-1" title="Direct link to heading">​</a></h4><table><thead><tr><th>pod 数量/影响范围</th><th>注入耗时</th><th>磁盘IO影响</th><th>网络带宽影响</th></tr></thead><tbody><tr><td>20</td><td>5s</td><td>几乎无影响</td><td>几乎无影响</td></tr><tr><td>50</td><td>27s</td><td>几乎无影响</td><td>几乎无影响</td></tr><tr><td>100</td><td>1m46s</td><td>几乎无影响</td><td>几乎无影响</td></tr></tbody></table><p>通过实验结果对比和观测图可以很明显的看到，chaosblade-operator 1.6.1 版本在注入过程中对在资源消耗方面几乎没有任何影响，注入耗时也有明显的提升；
对于其他新特性，比如兼容性提升、只读文件系统pod支持、无侵入等，也可以主动尝试去做更多的实验，相信你会有更深的理解。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="思考">思考<a class="hash-link" href="#思考" title="Direct link to heading">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="java-场景支撑">Java 场景支撑<a class="hash-link" href="#java-场景支撑" title="Direct link to heading">​</a></h3><p>ChaosBlade 对于容器 Java 场景的实现，是通过 JVM  attach javaagent 的能力实现的，也就意味着 JVM 在 attach 的时候必须能够查找到 javaagent.jar 包所在路径，所以目前必须将 javaagent.jar 复制进容器；如何能够更优雅做到容器 Java 场景的注入仍然值得我们去探索和突破。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="node-级别演练支撑">Node 级别演练支撑<a class="hash-link" href="#node-级别演练支撑" title="Direct link to heading">​</a></h3><p>ChaosBlade Operator 对于 Kubernetes Node 级别的演练支持是有限的，在 Node 场景注入故障时候，真正注入的是 chaosblade-tool  容器，chaosblade-tool 默认也只是进程和网络命令空间处在宿主机级别，因此在 chaosblade-tool 容器中支持网络延时、网络丢包、杀进程等场景，其实也是等同 Node 维度的网络延时、网络丢包、杀进程等场景；
对于其他 Kubernetes Node 的支持、并不能真正做到 Node 维度，比如 CPU、内存、磁盘IO 等必须得在  chaosblade-tool  容器没有被限制资源的情景下，才勉强算 Node  维度；而文件系统、Java 场景等目前是没有办法做到的；从另外一个角度出发思考，我们是否需要这些场景，在通常情况下在主机（Node）上安装 chaosblade
完全能够支持全部场景了。</p><p><em>相关链接</em>
<strong><em>ChaosBlade 官方网址</em></strong><em>：</em>
<em><a href="https://chaosblade.io/" target="_blank" rel="noopener noreferrer">https://chaosblade.io/</a></em>
<strong><em>ChaosBlade Github</em></strong><em>：</em>
<em><a href="https://github.com/chaosblade-io/chaosblade" target="_blank" rel="noopener noreferrer">https://github.com/chaosblade-io/chaosblade</a></em>
<strong><em>ChaosBlade 钉钉社区交流群</em></strong><em>：23177705</em></p><h1>作者简介：</h1><p>叶飞（Github账号：tiny-x）ChaosBlade  Maintainer。目前主要关注于混沌工程、云原生以及 Linux 内核相关。</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2022/09/09/chaosblade-java">ChaosBlade Java 场景性能优化，那些你不知道的事</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-09-09T00:00:00.000Z" itemprop="datePublished">September 9, 2022</time> · <!-- -->28 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/binbin0325" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/28588342?v=4" alt="张斌斌（@binbin0325）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/binbin0325" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">张斌斌（@binbin0325）</span></a></div><small class="avatar__subtitle" itemprop="description">Committer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><a href="https://chaosblade.io/" target="_blank" rel="noopener noreferrer">ChaosBlade</a> 是阿里巴巴开源的一款遵循混沌工程原理和混沌实验模型的实验注入工具，帮助企业提升分布式系统的容错能力，并且在企业上云或往云原生系统迁移过程中业务连续性保障。</p><p>目前支持的场景有：基础资源、Java 应用、C++ 应用、Docker 容器以及 Kubernetes 平台。该项目将场景按领域实现封装成单独的项目，不仅可以使领域内场景标准化实现，而且非常方便场景水平和垂直扩展，通过遵循混沌实验模型，实现 ChaosBlade cli 统一调用。</p><p>不过Java场景下的故障注入目前有一些性能问题,主要体现在故障注入时会让CPU的使用率大幅度抖动,严重情况下可能会导致CPU的使用率100%。这种情况对于线下服务的影响还好，但是对于线上服务就比较严重了，因为CPU的使用率较高有可能会导致服务的整体性能变差，从而影响接口的耗时。</p><p><strong>通过对ChaosBlade Java 场景的性能优化，使CPU在故障注入时的抖动得到了有效的控制，不会再出现CPU使用率达到100%的抖动，经过测试在线上8C，4G，QPS 3K左右的服务实例上注入Dubbo 自定义抛异常的故障，CPU的使用率可以控制在40%左右的瞬时抖动范围内,性能整体提升近2.5倍。</strong></p><p>本文将会详细的介绍影响性能的问题点以及是如何对这些问题进行优化的。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade Java 场景性能优化，那些你不知道的事" href="/en/blog/2022/09/09/chaosblade-java"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released-ch">ChaosBlade-Box全新混沌工程平台 -- 助力企业混沌工程落地</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-06-24T00:00:00.000Z" itemprop="datePublished">June 24, 2022</time> · <!-- -->9 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/MandssS" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/13030286?v=4" alt="蔡铭霞（铭少，@MandssS）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/MandssS" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">蔡铭霞（铭少，@MandssS）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>在2020.11.25 AWS发生了服务大面积故障，造成了多个云产品服务受影响，不到一个月的时间内谷歌发生了那年的第三次大规模宕机，造成了波及20亿用户，损失170万美元的巨大损失。
系统架构经历了单机 到 分布式，再到现在的云原生架构，其复杂度不断上涨，问题定位的难度也随之上涨。面对随时都可能发生的故障，有没有什么的办法能很好解决这个困境。
混沌工程（Chaos Engineering）在分布式系统上进行实验的学科，通过主动注入故障的方式，提前发现系统的薄弱点，推进架构的改进，最终实现业务韧性。从而避免故障在线上运行环境上发生。
<img loading="lazy" alt="image.png" src="/en/assets/images/fault-always-56a989a61eaa3728078e7ab3ba74c657.png" width="2608" height="1398" class="img_ev3q"></p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade-Box全新混沌工程平台 -- 助力企业混沌工程落地" href="/en/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released-ch"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released">ChaosBlade-Box, a New Version of the Chaos Engineering Platform Has Released</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-06-24T00:00:00.000Z" itemprop="datePublished">June 24, 2022</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/MandssS" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/13030286?v=4" alt="蔡铭霞（铭少，@MandssS）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/MandssS" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">蔡铭霞（铭少，@MandssS）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="image.png" src="/en/assets/images/logo-9bd69360af7a8fdb451b8de390c28c09.png" width="1768" height="274" class="img_ev3q"></p><h1>1. Preface</h1><ul><li><p>What Is ChaosBlade-Box?
ChaosBlade-Box is an open-source cloud-native Chaos Engineering console of Alibaba Cloud for multiple clusters, languages, and environments. The main features include a unified chaos experiment user interface, Chaos Engineering tool deployment (such as ChaosBlade and LitmusChaos), and the support for experimental scenario management and multi-dimensional experiments.</p></li><li><p>What Is ChaosBlade?
ChaosBlade is an easy-to-use, efficient, and open-source Chaos Engineering experimental tool of Alibaba Cloud, which conforms with the experimental model. It supports multi-platform, multi-language environment, and more than 200 drill scenarios, such as host system -&gt; container -&gt; Kubernetes cluster -&gt; common components (Elasticsearch, Redis, and MySQL) -&gt; application (Java, Golang, C++, and NodeJS), and over 3,000 parameters.</p></li><li><p>What Is Chaos Engineering?
Chaos Engineering is a discipline that conducts experiments on distributed systems. Chaos Engineering helps detect weak points of systems in advance, promotes the improvement of the architecture, and finally realizes business resilience by actively injecting faults.</p></li></ul><p>Since 2021, major enterprises have paid attention to and invested in the research and development of Chaos Engineering. ChaosBlade (an open-source Chaos Engineering tool from Alibaba) has officially become a CNCF Sandbox project. A new version of the ChaosBlade-Box was released to help users of open-source projects implement Chaos Engineering better. The following sections describe the features of the new version.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade-Box, a New Version of the Chaos Engineering Platform Has Released" href="/en/blog/2022/06/24/ChaosBlade-Box-a-New-Version-of-the-Chaos-Engineering-Platform-Has-Released"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2022/06/24/ChaosBlade-Box-new-release">混沌工程平台 ChaosBlade-Box 新版重磅发布</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-06-24T00:00:00.000Z" itemprop="datePublished">June 24, 2022</time> · <!-- -->10 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/MandssS" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/13030286?v=4" alt="蔡铭霞（铭少，@MandssS）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/MandssS" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">蔡铭霞（铭少，@MandssS）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><img loading="lazy" alt="image.png" src="/en/assets/images/logo-9bd69360af7a8fdb451b8de390c28c09.png" width="1768" height="274" class="img_ev3q"></p><h1>1. 前言</h1><ul><li><p>ChaosBlade-Box是什么？</p><blockquote><p>ChaosBlade-Box是面向多集群、多语言、多环境，阿里开源的云原生混沌工程控制台。主要功能有：统一混沌实验用户界面、混沌工程工具部署（ChaosBlade、LitmusChaos...）、支持实验场景管理和多维度实验等。</p></blockquote></li><li><p>ChaosBlade是什么？</p><blockquote><p>ChaosBlade是遵循实验模型、简单易用、功能强大的，阿里开源混沌工程实验工具。支持多平台、多语言环境，支持从 主机系统-&gt; 容器 -&gt; k8s集群 -&gt; 常用组件（ElasticSearch\Redis\Mysql...） -&gt; 应用 （Java\Golang\C++\NodeJS...）等200多个演练场景，3000多个参数。</p></blockquote></li><li><p>混沌工程是什么？</p><blockquote><p>混沌工程（Chaos Engineering）是在分布式系统上进行实验的学科，通过主动注入故障的方式，提前发现系统的薄弱点，推进架构的改进，最终实现业务韧性</p></blockquote></li></ul><p>2021年起进入混沌工程元年，各大公司纷纷关注并投入混沌工程的研发当中。阿里巴巴开源的混沌工程工具ChaosBlade正式成为CNCF Sandbox项目。为帮助开源用户更好的落地混沌工程，发布新版ChaosBlade-Box，以下主要介绍此次发布新版本的功能及特性。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about 混沌工程平台 ChaosBlade-Box 新版重磅发布" href="/en/blog/2022/06/24/ChaosBlade-Box-new-release"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2022/03/03/ChaosBlade-From-the-Chaos-Engineering-Experiment-Tool-to-the-Chaos-Engineering-Platform">ChaosBlade, From the Chaos Engineering Experiment Tool to the Chaos Engineering Platform</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-03-03T00:00:00.000Z" itemprop="datePublished">March 3, 2022</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/xcaspar" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/3992234?s=64&amp;v=4" alt="肖长军（穹谷，@xcaspar）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/xcaspar" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">肖长军（穹谷，@xcaspar）</span></a></div><small class="avatar__subtitle" itemprop="description">Co-creator of ChaosBlade</small></div></div></div><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">Sang Jie</span></div><small class="avatar__subtitle" itemprop="description">Works in the R&amp;D Center of Agricultural Bank of China and is engaged in big data R&amp;D in financial-related systems.</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>ChaosBlade is Alibaba&#x27;s open-source chaos engineering project created in 2019. It has been added to CNCF Sandbox. At first, ChaosBlade was a multi-environment and multi-language chaos engineering experimental tool but developed into a multi-cluster, multi-environment, and multi-language chaos engineering platform called chaosblade-box. The platform supports experimental tool hosting and automatic tool deployment. The user&#x27;s energy is focused on solving high-availability problems in the cloud-native process through chaos engineering and a unified user experiment interface. This article introduces ChaosBlade in detail from three stages, including the abstraction of the chaos experimental model, the open-source process of the chaos experimental tool, and the update of the chaos engineering platform.</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade, From the Chaos Engineering Experiment Tool to the Chaos Engineering Platform" href="/en/blog/2022/03/03/ChaosBlade-From-the-Chaos-Engineering-Experiment-Tool-to-the-Chaos-Engineering-Platform"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2021/12/08/chaos-engineering-value">被你质疑价值的混沌工程，阿里巴巴已落地实践了9年</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-12-08T00:00:00.000Z" itemprop="datePublished">December 8, 2021</time> · <!-- -->17 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><span itemprop="name">张俊宝</span></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>转自：<a href="https://mp.weixin.qq.com/s/jHopgbHmWCuF0JHv7Z7Erg" target="_blank" rel="noopener noreferrer">https://mp.weixin.qq.com/s/jHopgbHmWCuF0JHv7Z7Erg</a></p><p>为什么阿里巴巴、工商银行、中国移动、华泰证券……都在关注混沌工程？</p><p>自从 Netflix 开源 Chaos Monkey，越来越多的国内公司看到了混沌工程在建立系统在生产环境中信心的能力，开始尝试通过混沌工程提高可靠性。阿里巴巴作为国内较早对外输出混沌工程能力的企业，早在 2012 年就开始在电商业务上，尝试通过故障注入技术去解决微服务的依赖问题。</p><p>应用层追求更全面、更便利、更快捷的服务，倒逼技术层面系统越来越复杂，可供观测和持续维护的难度不断加大，错综相连的软件服务节点越发依赖技术手段和能力。随着分布式和云原生技术成为主流技术趋势，混沌工程也随之备受关注。由于混沌工程自身特性，#难以量化度量几乎成为业内共识，但对于企业混沌工程建设的成熟度，也需要探讨衡量标准。# </p><p>如今，随着中国信通院成立了国内首个混沌工程实验室，混沌工程在国内的发展走到了新阶段。为此，InfoQ 和阿里云资深技术专家中亭，聊了聊混沌工程在阿里巴巴的技术实践。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about 被你质疑价值的混沌工程，阿里巴巴已落地实践了9年" href="/en/blog/2021/12/08/chaos-engineering-value"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2021/06/06/summer-2021">暑期2021</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-06-06T00:00:00.000Z" itemprop="datePublished">June 6, 2021</time> · <!-- -->6 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/tiny-x" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/29175949?v=4" alt="叶飞"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/tiny-x" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">叶飞</span></a></div><small class="avatar__subtitle" itemprop="description">ChaosBlade PMC</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>欢迎参加<a href="https://summer.iscas.ac.cn/help/" target="_blank" rel="noopener noreferrer">开源软件供应链点亮计划</a> - 暑期 2021（以下简称 暑期 2021）是由 中国科学院软件研究所 与 openEuler 社区 共同举办的一项面向高校学生的暑期活动，旨在鼓励在校学生积极参与开源软件的开发维护，促进优秀开源软件社区的蓬勃发展。我们将联合各大开源社区，针对重要开源软件的开发与维护提供项目，并向全球高校学生开放报名。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about 暑期2021" href="/en/blog/2021/06/06/summer-2021"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2021/05/21/chaos-engineering">混沌工程介绍与实践</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2021-05-21T00:00:00.000Z" itemprop="datePublished">May 21, 2021</time> · <!-- -->15 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/xcaspar" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/3992234?s=64&amp;v=4" alt="肖长军（穹谷，@xcaspar）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/xcaspar" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">肖长军（穹谷，@xcaspar）</span></a></div><small class="avatar__subtitle" itemprop="description">Co-creator of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p>在分布式系统架构下，服务间的依赖日益复杂，很难评估单个服务故障对整个系统的影响，并且请求链路长，监控告警的不完善导致发现问题、定位问题难度增大，同时业务和技术迭代快，如何持续保障系统的稳定性和高可用性受到很大的挑战。我们知道发生故障的那一刻不是由你来选择的，而是那一刻来选择你，你能做的就是为之做好准备。所以构建稳定性系统很重要的一环是混沌工程，在可控范围或环境下，通过故障注入，来持续提升系统的稳定性和高可用能力。<br>
<!-- -->本文会着重介绍什么是混沌工程，为什么需要混沌工程以及混沌工程相关工具与实践。如有遗漏或错误，欢迎补充指正。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about 混沌工程介绍与实践" href="/en/blog/2021/05/21/chaos-engineering"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2020/08/06/chaosblade-start-5">ChaosBlade：从零开始的混沌工程（五）</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-08-06T00:00:00.000Z" itemprop="datePublished">August 6, 2020</time> · <!-- -->18 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/24563928?v=4" alt="郭旭东（@sunny0826）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">郭旭东（@sunny0826）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>在上篇文章中，我们介绍了如何使用 <strong>ChaosBlade Operator</strong> 对 node 资源进行混沌实验。从本章将继续对 Kubernetes Container 资源的混沌实验进行讲解，同时也配套了 <a href="https://katacoda.com/" target="_blank" rel="noopener noreferrer">katacode</a> 交互式教程，读者可用通过 katacode，在浏览器上操作真实的 Kubernetes 和 ChaosBlade，同时本篇也是系列文章的倒数第二篇，实践内容的最后一篇。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade：从零开始的混沌工程（五）" href="/en/blog/2020/08/06/chaosblade-start-5"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2020/07/22/chaosblade-start-4">ChaosBlade：从零开始的混沌工程（四）</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-07-22T00:00:00.000Z" itemprop="datePublished">July 22, 2020</time> · <!-- -->11 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/24563928?v=4" alt="郭旭东（@sunny0826）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">郭旭东（@sunny0826）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>在上篇文章中，我们介绍了如何使用 <strong>ChaosBlade Operator</strong> 对 pod 资源进行混沌实验。从本章将继续对 Kubernetes Node 资源的混沌实验进行讲解，同时也配套了 <a href="https://katacoda.com/" target="_blank" rel="noopener noreferrer">katacode</a> 交互式教程，读者可用通过 katacode，在浏览器上操作真实的 Kubernetes 和 ChaosBlade。</p><p><a href="https://chaosblade.io/" target="_blank" rel="noopener noreferrer">chaosblade.io</a> 官网已经正式上线。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade：从零开始的混沌工程（四）" href="/en/blog/2020/07/22/chaosblade-start-4"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2020/06/15/chaosblade-start-3">ChaosBlade：从零开始的混沌工程（三）</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-06-15T00:00:00.000Z" itemprop="datePublished">June 15, 2020</time> · <!-- -->12 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/24563928?v=4" alt="郭旭东（@sunny0826）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">郭旭东（@sunny0826）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>在上篇文章中，我们介绍了如何安装 <strong>ChaosBlade Operator</strong>，并进行了简单的使用。从本章开始，所有的实践章节，都会有配套的 <a href="https://katacoda.com/" target="_blank" rel="noopener noreferrer">katacode</a> 交互式教程，读者可用通过 katacode，在浏览器上操作真实的 Kubernetes 和 ChaosBlade。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade：从零开始的混沌工程（三）" href="/en/blog/2020/06/15/chaosblade-start-3"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2020/06/09/chaosblade-start-2">ChaosBlade：从零开始的混沌工程（二）</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-06-09T00:00:00.000Z" itemprop="datePublished">June 9, 2020</time> · <!-- -->5 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/24563928?v=4" alt="郭旭东（@sunny0826）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">郭旭东（@sunny0826）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>在上篇文章中，我们介绍了<strong>混沌工程</strong>以及 <strong>ChaosBlade</strong>。从本篇开始，从 ChaosBlade 的安装部署，到实验的创建销毁，在实践的角度，一步步的完成各种混沌实验，深入认识和使用混沌工程。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade：从零开始的混沌工程（二）" href="/en/blog/2020/06/09/chaosblade-start-2"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2020/06/04/chaosblade-start-1">ChaosBlade：从零开始的混沌工程（一）</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2020-06-04T00:00:00.000Z" itemprop="datePublished">June 4, 2020</time> · <!-- -->7 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/24563928?v=4" alt="郭旭东（@sunny0826）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/sunny0826" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">郭旭东（@sunny0826）</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><h2 class="anchor anchorWithStickyNavbar_LWe7" id="前言">前言<a class="hash-link" href="#前言" title="Direct link to heading">​</a></h2><p>随着微服务的盛行以及容器技术的普及，借助 Kubernetes 的容器编排能力，部署一套分布式系统的难度也越来越低。但随之而来的是越来越复杂的系统，以及越来越难的系统可靠性测试，有时仅仅是一个接口的故障，就可能导致整个系统的雪崩。在雪崩中，找到那个最初故障的接口也十分困难，因为到处都在报错。</p><p>为了解决这些问题，除了不断减少服务的耦合，建立强大的监控系统以及设置熔断、限流等策略等方式，这时<strong>混沌工程</strong>就出现了。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade：从零开始的混沌工程（一）" href="/en/blog/2020/06/04/chaosblade-start-1"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2019/10/17/chaosblade-cloud-native">ChaosBlade：云原生架构下的混沌工程探索和实践</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2019-10-17T00:00:00.000Z" itemprop="datePublished">October 17, 2019</time> · <!-- -->33 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/xcaspar" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://avatars.githubusercontent.com/u/3992234?s=64&amp;v=4" alt="肖长军（穹谷，@xcaspar）"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/xcaspar" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">肖长军（穹谷，@xcaspar）</span></a></div><small class="avatar__subtitle" itemprop="description">Co-creator of ChaosBlade</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>导读：随着云原生概念的兴起，越来越多的系统服务在往云原生演进，在演进阶段如何保障系统的稳定性和高可用性，是每个系统负责人都要关注的问题，通过混沌工程可以很好的解决这个问题。ChaosBlade 是阿里巴巴开源的一款混沌工程实验执行工具，其易用性和丰富的场景受到大家的广泛关注。本文整理自阿里巴巴技术专家肖长军（穹谷）在 QCon 全球软件开发大会（上海站）2019 上的演讲，他围绕云原生架构介绍了 ChaosBlade 的设计、特性与实践，以及如何基于 ChaosBlade 搭建一个自动化的混沌实验平台。</p></blockquote></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about ChaosBlade：云原生架构下的混沌工程探索和实践" href="/en/blog/2019/10/17/chaosblade-cloud-native"><b>Read More</b></a></div></footer></article><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/en/blog/2019/07/03/chaosblade-chaos-engineering-tools">Chaosblade, 阿里一个超级牛逼的混沌实验实施工具</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2019-07-03T00:00:00.000Z" itemprop="datePublished">July 3, 2019</time> · <!-- -->14 min read</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://juejin.cn/user/4353721774901806" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://p3-passport.byteimg.com/img/user-avatar/023f14b3a5377f09b98af09696e3c6ac~180x180.awebp" alt="1点25"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://juejin.cn/user/4353721774901806" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">1点25</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>转自：<a href="https://juejin.cn/post/6844903879814053901" target="_blank" rel="noopener noreferrer">https://juejin.cn/post/6844903879814053901</a>
来源：稀土掘金</p></blockquote><h1>Chaosblade是什么？</h1><p>Chaosblade是遵循混沌工程（Chaos Engineering）原理的实验工具，用于模拟常见的故障场景，帮助提升分布式系统的可恢复性和对故障的容错性。
Chaosblade是建立在阿里巴巴近十年故障测试和演练实践基础上，结合了集团各业务的最佳创意和实践。
目前支持的演练场景有操作系统类的 CPU、磁盘、进程、网络，Java 应用类的 Dubbo、MySQL、Servlet 和自定义类方法延迟或抛异常等以及杀容器、杀 Pod，具体可执行 blade create -h 查看。
好了，上面的介绍是从Chaosblade的github主页抄的。
github主页地址：<a href="https://github.com/chaosblade-io/chaosblade" target="_blank" rel="noopener noreferrer">chaosblade-github</a>
说白了，Chaosblade是一个故障模拟工具，可以模拟比如服务器CPU满了、磁盘满了、网络慢、Dubbo某个服务响应时间长、jvm中某个方法抛出异常、调用Mysql慢等等。所以这个工具对于大公司来说是非常非常有用的，因为可以提前模拟出各种各样的故障，从而保证系统的高可用与稳定。</p></div><footer class="row docusaurus-mt-lg"><div class="col col--9"><b>Tags:</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/en/blog/tags/chaosblade">chaosblade</a></li></ul></div><div class="col text--right col--3"><a aria-label="Read more about Chaosblade, 阿里一个超级牛逼的混沌实验实施工具" href="/en/blog/2019/07/03/chaosblade-chaos-engineering-tools"><b>Read More</b></a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/en/docs">About ChaosBlade</a></li><li class="footer__item"><a class="footer__link-item" href="/en/docs/community/docs">Contribute documents</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://gitter.im/chaosblade-io/community" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/chaosblade.io" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://join.slack.com/t/chaosblade-io/shared_invite/zt-f0d3r3f4-TDK13Wr3QRUrAhems28p1w" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a class="footer__link-item" href="/en/">DingTalk(23177705)</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.netlify.com"><img src="https://www.netlify.com/img/global/badges/netlify-color-accent.svg" alt="Deploys by Netlify"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://cncf.io/" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/en/img/cncf-white.svg" alt="CNCF" class="themedImage_ToTc themedImage--light_HNdA footer__logo"><img src="/en/img/cncf-white.svg" alt="CNCF" class="themedImage_ToTc themedImage--dark_i4oU footer__logo"></a></div><div class="footer__copyright">© 2022 The ChaosBlade Authors. All rights reserved. <br>
            The Linux Foundation has registered trademarks and uses trademarks. 
            For a list of trademarks of The Linux Foundation, 
            please see our <a href="https://www.linuxfoundation.org/trademark-usage/"> Trademark Usage</a> page.</div></div></div></footer></div>
<script src="/en/assets/js/runtime~main.0f7f60ef.js"></script>
<script src="/en/assets/js/main.a201f323.js"></script>
</body>
</html>